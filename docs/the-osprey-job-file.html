<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 The Osprey job file | Osprey Documentation</title>
  <meta name="description" content="Osprey is an all-in-one software suite for state-of-the art processing and quantitative analysis of in-vivo magnetic resonance spectroscopy (MRS) data." />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 The Osprey job file | Osprey Documentation" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Osprey is an all-in-one software suite for state-of-the art processing and quantitative analysis of in-vivo magnetic resonance spectroscopy (MRS) data." />
  <meta name="github-repo" content="schorschinho/osprey" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 The Osprey job file | Osprey Documentation" />
  
  <meta name="twitter:description" content="Osprey is an all-in-one software suite for state-of-the art processing and quantitative analysis of in-vivo magnetic resonance spectroscopy (MRS) data." />
  

<meta name="author" content="Georg Oeltzschner" />


<meta name="date" content="2024-12-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="the-osprey-workflow.html"/>
<link rel="next" href="osprey-gui-tutorial.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Osprey Documentation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Osprey</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contact-feedback-suggestions"><i class="fa fa-check"></i>Contact, Feedback, Suggestions</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#developers"><i class="fa fa-check"></i>Developers</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="faqs.html"><a href="faqs.html"><i class="fa fa-check"></i><b>1</b> FAQs</a></li>
<li class="chapter" data-level="2" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>2</b> Getting started</a>
<ul>
<li class="chapter" data-level="2.1" data-path="getting-started.html"><a href="getting-started.html#system-requirements"><i class="fa fa-check"></i><b>2.1</b> System requirements</a></li>
<li class="chapter" data-level="2.2" data-path="getting-started.html"><a href="getting-started.html#installing-osprey-and-necessary-dependencies"><i class="fa fa-check"></i><b>2.2</b> Installing Osprey and necessary dependencies</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="getting-started.html"><a href="getting-started.html#osprey-package"><i class="fa fa-check"></i><b>2.2.1</b> Osprey package</a></li>
<li class="chapter" data-level="2.2.2" data-path="getting-started.html"><a href="getting-started.html#spm-package"><i class="fa fa-check"></i><b>2.2.2</b> SPM package</a></li>
<li class="chapter" data-level="2.2.3" data-path="getting-started.html"><a href="getting-started.html#gui-toolboxes"><i class="fa fa-check"></i><b>2.2.3</b> GUI Toolboxes</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="getting-started.html"><a href="getting-started.html#how-to-organize-your-raw-data"><i class="fa fa-check"></i><b>2.3</b> How to organize your raw data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="the-osprey-workflow.html"><a href="the-osprey-workflow.html"><i class="fa fa-check"></i><b>3</b> The Osprey Workflow</a></li>
<li class="chapter" data-level="4" data-path="the-osprey-job-file.html"><a href="the-osprey-job-file.html"><i class="fa fa-check"></i><b>4</b> The Osprey job file</a>
<ul>
<li class="chapter" data-level="4.1" data-path="the-osprey-job-file.html"><a href="the-osprey-job-file.html#example-job-file"><i class="fa fa-check"></i><b>4.1</b> Example job file</a></li>
<li class="chapter" data-level="4.2" data-path="the-osprey-job-file.html"><a href="the-osprey-job-file.html#specifying-sequence-information"><i class="fa fa-check"></i><b>4.2</b> Specifying Sequence Information</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="the-osprey-job-file.html"><a href="the-osprey-job-file.html#sequence-type"><i class="fa fa-check"></i><b>4.2.1</b> Sequence Type</a></li>
<li class="chapter" data-level="4.2.2" data-path="the-osprey-job-file.html"><a href="the-osprey-job-file.html#editing-targets"><i class="fa fa-check"></i><b>4.2.2</b> Editing Targets</a></li>
<li class="chapter" data-level="4.2.3" data-path="the-osprey-job-file.html"><a href="the-osprey-job-file.html#data-scenario"><i class="fa fa-check"></i><b>4.2.3</b> Data Scenario</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="the-osprey-job-file.html"><a href="the-osprey-job-file.html#data-handling-and-modeling-options"><i class="fa fa-check"></i><b>4.3</b> Data handling and modeling options</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="the-osprey-job-file.html"><a href="the-osprey-job-file.html#spectral-registration-options"><i class="fa fa-check"></i><b>4.3.1</b> Spectral registration options</a></li>
<li class="chapter" data-level="4.3.2" data-path="the-osprey-job-file.html"><a href="the-osprey-job-file.html#sub-spectral-alignment"><i class="fa fa-check"></i><b>4.3.2</b> Sub-spectral alignment</a></li>
<li class="chapter" data-level="4.3.3" data-path="the-osprey-job-file.html"><a href="the-osprey-job-file.html#eddy-current-correction"><i class="fa fa-check"></i><b>4.3.3</b> Eddy-current correction</a></li>
<li class="chapter" data-level="4.3.4" data-path="the-osprey-job-file.html"><a href="the-osprey-job-file.html#saving-data-to-external-formats"><i class="fa fa-check"></i><b>4.3.4</b> Saving data to external formats</a></li>
<li class="chapter" data-level="4.3.5" data-path="the-osprey-job-file.html"><a href="the-osprey-job-file.html#metabolites-included-in-the-basis-set"><i class="fa fa-check"></i><b>4.3.5</b> Metabolites included in the basis-set</a></li>
<li class="chapter" data-level="4.3.6" data-path="the-osprey-job-file.html"><a href="the-osprey-job-file.html#lcmodel-specific-options"><i class="fa fa-check"></i><b>4.3.6</b> LCModel-specific options</a></li>
<li class="chapter" data-level="4.3.7" data-path="the-osprey-job-file.html"><a href="the-osprey-job-file.html#fit-style"><i class="fa fa-check"></i><b>4.3.7</b> Fit style</a></li>
<li class="chapter" data-level="4.3.8" data-path="the-osprey-job-file.html"><a href="the-osprey-job-file.html#fitting-range"><i class="fa fa-check"></i><b>4.3.8</b> Fitting range</a></li>
<li class="chapter" data-level="4.3.9" data-path="the-osprey-job-file.html"><a href="the-osprey-job-file.html#baseline-knot-spacing"><i class="fa fa-check"></i><b>4.3.9</b> Baseline knot spacing</a></li>
<li class="chapter" data-level="4.3.10" data-path="the-osprey-job-file.html"><a href="the-osprey-job-file.html#macromolecule-and-lipid-signals"><i class="fa fa-check"></i><b>4.3.10</b> Macromolecule and lipid signals</a></li>
<li class="chapter" data-level="4.3.11" data-path="the-osprey-job-file.html"><a href="the-osprey-job-file.html#co-edited-macromolecules"><i class="fa fa-check"></i><b>4.3.11</b> Co-edited macromolecules</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="the-osprey-job-file.html"><a href="the-osprey-job-file.html#specifying-mrs-data-and-structural-imaging-files"><i class="fa fa-check"></i><b>4.4</b> Specifying MRS data and structural imaging files</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="the-osprey-job-file.html"><a href="the-osprey-job-file.html#metabolite-data"><i class="fa fa-check"></i><b>4.4.1</b> Metabolite data</a></li>
<li class="chapter" data-level="4.4.2" data-path="the-osprey-job-file.html"><a href="the-osprey-job-file.html#lineshape-reference-data"><i class="fa fa-check"></i><b>4.4.2</b> Lineshape reference data</a></li>
<li class="chapter" data-level="4.4.3" data-path="the-osprey-job-file.html"><a href="the-osprey-job-file.html#short-te-water-data"><i class="fa fa-check"></i><b>4.4.3</b> Short-TE water data</a></li>
<li class="chapter" data-level="4.4.4" data-path="the-osprey-job-file.html"><a href="the-osprey-job-file.html#structural-images"><i class="fa fa-check"></i><b>4.4.4</b> Structural images</a></li>
<li class="chapter" data-level="4.4.5" data-path="the-osprey-job-file.html"><a href="the-osprey-job-file.html#specifying-stat-file"><i class="fa fa-check"></i><b>4.4.5</b> Specifying stat file</a></li>
<li class="chapter" data-level="4.4.6" data-path="the-osprey-job-file.html"><a href="the-osprey-job-file.html#specifying-the-output-folder"><i class="fa fa-check"></i><b>4.4.6</b> Specifying the output folder</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="osprey-gui-tutorial.html"><a href="osprey-gui-tutorial.html"><i class="fa fa-check"></i><b>5</b> Osprey GUI tutorial</a>
<ul>
<li class="chapter" data-level="5.1" data-path="osprey-gui-tutorial.html"><a href="osprey-gui-tutorial.html#starting-osprey"><i class="fa fa-check"></i><b>5.1</b> Starting Osprey</a></li>
<li class="chapter" data-level="5.2" data-path="osprey-gui-tutorial.html"><a href="osprey-gui-tutorial.html#loading-a-job-file"><i class="fa fa-check"></i><b>5.2</b> Loading a job file</a></li>
<li class="chapter" data-level="5.3" data-path="osprey-gui-tutorial.html"><a href="osprey-gui-tutorial.html#loading-the-raw-mrs-data"><i class="fa fa-check"></i><b>5.3</b> Loading the raw MRS data</a></li>
<li class="chapter" data-level="5.4" data-path="osprey-gui-tutorial.html"><a href="osprey-gui-tutorial.html#processing-the-raw-data"><i class="fa fa-check"></i><b>5.4</b> Processing the raw data</a></li>
<li class="chapter" data-level="5.5" data-path="osprey-gui-tutorial.html"><a href="osprey-gui-tutorial.html#fitting-the-spectra"><i class="fa fa-check"></i><b>5.5</b> Fitting the spectra</a></li>
<li class="chapter" data-level="5.6" data-path="osprey-gui-tutorial.html"><a href="osprey-gui-tutorial.html#co-registering-to-an-anatomical-image"><i class="fa fa-check"></i><b>5.6</b> Co-registering to an anatomical image</a></li>
<li class="chapter" data-level="5.7" data-path="osprey-gui-tutorial.html"><a href="osprey-gui-tutorial.html#segmentation-and-tissue-fraction-calculation"><i class="fa fa-check"></i><b>5.7</b> Segmentation and tissue fraction calculation</a></li>
<li class="chapter" data-level="5.8" data-path="osprey-gui-tutorial.html"><a href="osprey-gui-tutorial.html#quantification"><i class="fa fa-check"></i><b>5.8</b> Quantification</a></li>
<li class="chapter" data-level="5.9" data-path="osprey-gui-tutorial.html"><a href="osprey-gui-tutorial.html#overview"><i class="fa fa-check"></i><b>5.9</b> Overview</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="osprey-command-line-tutorial.html"><a href="osprey-command-line-tutorial.html"><i class="fa fa-check"></i><b>6</b> Osprey command line tutorial</a></li>
<li class="chapter" data-level="7" data-path="osprey-basis-set-tools.html"><a href="osprey-basis-set-tools.html"><i class="fa fa-check"></i><b>7</b> Osprey basis set tools</a>
<ul>
<li class="chapter" data-level="7.1" data-path="osprey-basis-set-tools.html"><a href="osprey-basis-set-tools.html#io_lcmbasis"><i class="fa fa-check"></i><b>7.1</b> io_LCMBasis</a></li>
<li class="chapter" data-level="7.2" data-path="osprey-basis-set-tools.html"><a href="osprey-basis-set-tools.html#fit_makebasis"><i class="fa fa-check"></i><b>7.2</b> fit_makeBasis</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="osprey-basis-set-tools.html"><a href="osprey-basis-set-tools.html#complete-syntax"><i class="fa fa-check"></i><b>7.2.1</b> Complete syntax</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="osprey-basis-set-tools.html"><a href="osprey-basis-set-tools.html#fit_plotbasis"><i class="fa fa-check"></i><b>7.3</b> fit_plotBasis</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="osprey-basis-set-tools.html"><a href="osprey-basis-set-tools.html#complete-syntax-1"><i class="fa fa-check"></i><b>7.3.1</b> Complete syntax</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Osprey Documentation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="the-osprey-job-file" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> The Osprey job file<a href="the-osprey-job-file.html#the-osprey-job-file" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Every <strong>Osprey</strong> analysis requires the user to provide a job file. The <strong>Osprey</strong> job file is the only direct point of contact between the user and the analysis. It contains paths to MRS data files and structural images, defines processing and modeling options, and determines whether (and where) output files are being saved.</p>
<p>The job file system ensures that all processing, modeling, and quantification steps are performed in an operator-independent, reproducible way.</p>
<div id="example-job-file" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Example job file<a href="the-osprey-job-file.html#example-job-file" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The following box contains the <a href="https://github.com/schorschinho/osprey/blob/develop/exampledata/sdat/UnEdited/jobSDAT.m">example job file <code>jobSDAT.m</code></a>, defining a batched analysis of the two Philips PRESS (TE = 30 ms) datasets that are included in the <code>exampledata/sdat/</code> directory of the <a href="https://github.com/schorschinho/osprey"><strong>Osprey</strong> repository</a>. You can click on the dropdown arrow on the right to take a look through the file, and then read on for a detailed description of each job file item.</p>
<p>Example job file <code>jobSDAT.m</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode octave"><code class="sourceCode octave"><span id="cb1-1"><a href="the-osprey-job-file.html#cb1-1" tabindex="-1"></a><span class="co">%% jobSDAT.m</span></span>
<span id="cb1-2"><a href="the-osprey-job-file.html#cb1-2" tabindex="-1"></a><span class="co">%   This function describes an Osprey job defined in a MATLAB script.</span></span>
<span id="cb1-3"><a href="the-osprey-job-file.html#cb1-3" tabindex="-1"></a><span class="co">%</span></span>
<span id="cb1-4"><a href="the-osprey-job-file.html#cb1-4" tabindex="-1"></a><span class="co">%   A valid Osprey job contains four distinct classes of items:</span></span>
<span id="cb1-5"><a href="the-osprey-job-file.html#cb1-5" tabindex="-1"></a><span class="co">%       1. basic information on the MRS sequence used</span></span>
<span id="cb1-6"><a href="the-osprey-job-file.html#cb1-6" tabindex="-1"></a><span class="co">%       2. several settings for data handling and modeling</span></span>
<span id="cb1-7"><a href="the-osprey-job-file.html#cb1-7" tabindex="-1"></a><span class="co">%       3. a list of MRS (and, optionally, structural imaging) data files</span></span>
<span id="cb1-8"><a href="the-osprey-job-file.html#cb1-8" tabindex="-1"></a><span class="co">%          to be loaded</span></span>
<span id="cb1-9"><a href="the-osprey-job-file.html#cb1-9" tabindex="-1"></a><span class="co">%       4. an output folder to store the results and exported files</span></span>
<span id="cb1-10"><a href="the-osprey-job-file.html#cb1-10" tabindex="-1"></a><span class="co">%</span></span>
<span id="cb1-11"><a href="the-osprey-job-file.html#cb1-11" tabindex="-1"></a><span class="co">%   The list of MRS and structural imaging files is provided in the form of</span></span>
<span id="cb1-12"><a href="the-osprey-job-file.html#cb1-12" tabindex="-1"></a><span class="co">%   cell arrays. They can simply be provided explicitly, or from a more</span></span>
<span id="cb1-13"><a href="the-osprey-job-file.html#cb1-13" tabindex="-1"></a><span class="co">%   complex script that automatically determines file names from a given</span></span>
<span id="cb1-14"><a href="the-osprey-job-file.html#cb1-14" tabindex="-1"></a><span class="co">%   folder structure.</span></span>
<span id="cb1-15"><a href="the-osprey-job-file.html#cb1-15" tabindex="-1"></a><span class="co">%</span></span>
<span id="cb1-16"><a href="the-osprey-job-file.html#cb1-16" tabindex="-1"></a><span class="co">%   Osprey distinguishes between four sets of data:</span></span>
<span id="cb1-17"><a href="the-osprey-job-file.html#cb1-17" tabindex="-1"></a><span class="co">%       - metabolite (water-suppressed) data</span></span>
<span id="cb1-18"><a href="the-osprey-job-file.html#cb1-18" tabindex="-1"></a><span class="co">%           (MANDATORY)</span></span>
<span id="cb1-19"><a href="the-osprey-job-file.html#cb1-19" tabindex="-1"></a><span class="co">%           Defined in cell array &quot;files&quot;</span></span>
<span id="cb1-20"><a href="the-osprey-job-file.html#cb1-20" tabindex="-1"></a><span class="co">%       - water reference data acquired with the SAME sequence as the</span></span>
<span id="cb1-21"><a href="the-osprey-job-file.html#cb1-21" tabindex="-1"></a><span class="co">%           metabolite data, just without water suppression RF pulses. This</span></span>
<span id="cb1-22"><a href="the-osprey-job-file.html#cb1-22" tabindex="-1"></a><span class="co">%           data is used to determine complex coil combination</span></span>
<span id="cb1-23"><a href="the-osprey-job-file.html#cb1-23" tabindex="-1"></a><span class="co">%           coefficients, and perform eddy current correction.</span></span>
<span id="cb1-24"><a href="the-osprey-job-file.html#cb1-24" tabindex="-1"></a><span class="co">%           (OPTIONAL)</span></span>
<span id="cb1-25"><a href="the-osprey-job-file.html#cb1-25" tabindex="-1"></a><span class="co">%           Defined in cell array &quot;files_ref&quot;</span></span>
<span id="cb1-26"><a href="the-osprey-job-file.html#cb1-26" tabindex="-1"></a><span class="co">%       - additional water data used for water-scaled quantification,</span></span>
<span id="cb1-27"><a href="the-osprey-job-file.html#cb1-27" tabindex="-1"></a><span class="co">%           usually from short-TE acquisitions due to reduced T2-weighting</span></span>
<span id="cb1-28"><a href="the-osprey-job-file.html#cb1-28" tabindex="-1"></a><span class="co">%           (OPTIONAL)</span></span>
<span id="cb1-29"><a href="the-osprey-job-file.html#cb1-29" tabindex="-1"></a><span class="co">%           Defined in cell array &quot;files_w&quot;</span></span>
<span id="cb1-30"><a href="the-osprey-job-file.html#cb1-30" tabindex="-1"></a><span class="co">%       - Structural image data used for co-registration and tissue class</span></span>
<span id="cb1-31"><a href="the-osprey-job-file.html#cb1-31" tabindex="-1"></a><span class="co">%           segmentation (usually a T1 MPRAGE). These files need to be</span></span>
<span id="cb1-32"><a href="the-osprey-job-file.html#cb1-32" tabindex="-1"></a><span class="co">%           provided in the NIfTI format (*.nii or *.nii.gz) or, for GE data, as a</span></span>
<span id="cb1-33"><a href="the-osprey-job-file.html#cb1-33" tabindex="-1"></a><span class="co">%           folder containing DICOM Files (*.dcm).</span></span>
<span id="cb1-34"><a href="the-osprey-job-file.html#cb1-34" tabindex="-1"></a><span class="co">%           (OPTIONAL)</span></span>
<span id="cb1-35"><a href="the-osprey-job-file.html#cb1-35" tabindex="-1"></a><span class="co">%           Defined in cell array &quot;files_nii&quot;</span></span>
<span id="cb1-36"><a href="the-osprey-job-file.html#cb1-36" tabindex="-1"></a><span class="co">%       - External segmentation results. These files need to be</span></span>
<span id="cb1-37"><a href="the-osprey-job-file.html#cb1-37" tabindex="-1"></a><span class="co">%           provided in the NIfTI format (*.nii or *.nii.gz).</span></span>
<span id="cb1-38"><a href="the-osprey-job-file.html#cb1-38" tabindex="-1"></a><span class="co">%           (OPTIONAL)</span></span>
<span id="cb1-39"><a href="the-osprey-job-file.html#cb1-39" tabindex="-1"></a><span class="co">%           Defined in cell array &quot;files_seg&quot; with 1 x 3 cell for each</span></span>
<span id="cb1-40"><a href="the-osprey-job-file.html#cb1-40" tabindex="-1"></a><span class="co">%           subject or 1 x 1 cell if a single 4D NIfTI is supplied.</span></span>
<span id="cb1-41"><a href="the-osprey-job-file.html#cb1-41" tabindex="-1"></a><span class="co">%</span></span>
<span id="cb1-42"><a href="the-osprey-job-file.html#cb1-42" tabindex="-1"></a><span class="co">%   Files in the formats</span></span>
<span id="cb1-43"><a href="the-osprey-job-file.html#cb1-43" tabindex="-1"></a><span class="co">%       - .7 (GE)</span></span>
<span id="cb1-44"><a href="the-osprey-job-file.html#cb1-44" tabindex="-1"></a><span class="co">%       - .SDAT, .DATA/.LIST, .RAW/.SIN/.LAB (Philips)</span></span>
<span id="cb1-45"><a href="the-osprey-job-file.html#cb1-45" tabindex="-1"></a><span class="co">%       - .DAT (Siemens)</span></span>
<span id="cb1-46"><a href="the-osprey-job-file.html#cb1-46" tabindex="-1"></a><span class="co">%       - .nii, .nii.gz (NIfTI-MRS)</span></span>
<span id="cb1-47"><a href="the-osprey-job-file.html#cb1-47" tabindex="-1"></a><span class="co">%   usually contain all of the acquired data in a single file per scan. GE</span></span>
<span id="cb1-48"><a href="the-osprey-job-file.html#cb1-48" tabindex="-1"></a><span class="co">%   systems store water reference data in the same .7 file, so there is no</span></span>
<span id="cb1-49"><a href="the-osprey-job-file.html#cb1-49" tabindex="-1"></a><span class="co">%   need to specify it separately under files_ref.</span></span>
<span id="cb1-50"><a href="the-osprey-job-file.html#cb1-50" tabindex="-1"></a><span class="co">%</span></span>
<span id="cb1-51"><a href="the-osprey-job-file.html#cb1-51" tabindex="-1"></a><span class="co">%   Files in the formats</span></span>
<span id="cb1-52"><a href="the-osprey-job-file.html#cb1-52" tabindex="-1"></a><span class="co">%       - .DCM (any)</span></span>
<span id="cb1-53"><a href="the-osprey-job-file.html#cb1-53" tabindex="-1"></a><span class="co">%       - .IMA, .RDA (Siemens)</span></span>
<span id="cb1-54"><a href="the-osprey-job-file.html#cb1-54" tabindex="-1"></a><span class="co">%   may contain separate files for each average. Instead of providing</span></span>
<span id="cb1-55"><a href="the-osprey-job-file.html#cb1-55" tabindex="-1"></a><span class="co">%   individual file names, please specify folders. Metabolite data, water</span></span>
<span id="cb1-56"><a href="the-osprey-job-file.html#cb1-56" tabindex="-1"></a><span class="co">%   reference data, and water data need to be located in separate folders.</span></span>
<span id="cb1-57"><a href="the-osprey-job-file.html#cb1-57" tabindex="-1"></a><span class="co">%</span></span>
<span id="cb1-58"><a href="the-osprey-job-file.html#cb1-58" tabindex="-1"></a><span class="co">%   In the example script at hand the MATLAB functions strrep and which are</span></span>
<span id="cb1-59"><a href="the-osprey-job-file.html#cb1-59" tabindex="-1"></a><span class="co">%   used to generate a relative path, which allows you to run the examples</span></span>
<span id="cb1-60"><a href="the-osprey-job-file.html#cb1-60" tabindex="-1"></a><span class="co">%   on your machine directly. To set up your own Osprey job supply the</span></span>
<span id="cb1-61"><a href="the-osprey-job-file.html#cb1-61" tabindex="-1"></a><span class="co">%   specific locations as described above.</span></span>
<span id="cb1-62"><a href="the-osprey-job-file.html#cb1-62" tabindex="-1"></a><span class="co">%</span></span>
<span id="cb1-63"><a href="the-osprey-job-file.html#cb1-63" tabindex="-1"></a><span class="co">%   AUTHOR:</span></span>
<span id="cb1-64"><a href="the-osprey-job-file.html#cb1-64" tabindex="-1"></a><span class="co">%       Dr. Georg Oeltzschner (Johns Hopkins University, 2019-07-15)</span></span>
<span id="cb1-65"><a href="the-osprey-job-file.html#cb1-65" tabindex="-1"></a><span class="co">%       goeltzs1@jhmi.edu</span></span>
<span id="cb1-66"><a href="the-osprey-job-file.html#cb1-66" tabindex="-1"></a><span class="co">%</span></span>
<span id="cb1-67"><a href="the-osprey-job-file.html#cb1-67" tabindex="-1"></a><span class="co">%   HISTORY:</span></span>
<span id="cb1-68"><a href="the-osprey-job-file.html#cb1-68" tabindex="-1"></a><span class="co">%       2019-07-15: First version of the code.</span></span>
<span id="cb1-69"><a href="the-osprey-job-file.html#cb1-69" tabindex="-1"></a></span>
<span id="cb1-70"><a href="the-osprey-job-file.html#cb1-70" tabindex="-1"></a></span>
<span id="cb1-71"><a href="the-osprey-job-file.html#cb1-71" tabindex="-1"></a></span>
<span id="cb1-72"><a href="the-osprey-job-file.html#cb1-72" tabindex="-1"></a><span class="co">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span>
<span id="cb1-73"><a href="the-osprey-job-file.html#cb1-73" tabindex="-1"></a><span class="co">%%% 1. SPECIFY SEQUENCE INFORMATION %%%</span></span>
<span id="cb1-74"><a href="the-osprey-job-file.html#cb1-74" tabindex="-1"></a></span>
<span id="cb1-75"><a href="the-osprey-job-file.html#cb1-75" tabindex="-1"></a><span class="co">% Specify sequence type</span></span>
<span id="cb1-76"><a href="the-osprey-job-file.html#cb1-76" tabindex="-1"></a>seqType <span class="op">=</span> <span class="st">&#39;unedited&#39;</span><span class="op">;</span>           <span class="co">% OPTIONS:    - &#39;unedited&#39; (default)</span></span>
<span id="cb1-77"><a href="the-osprey-job-file.html#cb1-77" tabindex="-1"></a>                                <span class="co">%             - &#39;MEGA&#39;</span></span>
<span id="cb1-78"><a href="the-osprey-job-file.html#cb1-78" tabindex="-1"></a>                                <span class="co">%             - &#39;HERMES&#39;</span></span>
<span id="cb1-79"><a href="the-osprey-job-file.html#cb1-79" tabindex="-1"></a>                                <span class="co">%             - &#39;HERCULES&#39;</span></span>
<span id="cb1-80"><a href="the-osprey-job-file.html#cb1-80" tabindex="-1"></a></span>
<span id="cb1-81"><a href="the-osprey-job-file.html#cb1-81" tabindex="-1"></a><span class="co">% Specify editing targets</span></span>
<span id="cb1-82"><a href="the-osprey-job-file.html#cb1-82" tabindex="-1"></a>editTarget <span class="op">=</span> {<span class="st">&#39;none&#39;</span>}<span class="op">;</span>          <span class="co">% OPTIONS:    - {&#39;none&#39;} (default if &#39;unedited&#39;)</span></span>
<span id="cb1-83"><a href="the-osprey-job-file.html#cb1-83" tabindex="-1"></a>                                <span class="co">%             - {&#39;GABA&#39;}, {&#39;GSH&#39;}, {&#39;Lac&#39;}, {&#39;PE322&#39;}, {&#39;PE398&#39;}  (for &#39;MEGA&#39;)</span></span>
<span id="cb1-84"><a href="the-osprey-job-file.html#cb1-84" tabindex="-1"></a>                                <span class="co">%             - {&#39;GABA&#39;, &#39;GSH&#39;}, {&#39;GABA&#39;, &#39;Lac&#39;}, {&#39;NAA&#39;, &#39;NAAG&#39;} (for &#39;HERMES&#39;and &#39;HERCULES&#39;)</span></span>
<span id="cb1-85"><a href="the-osprey-job-file.html#cb1-85" tabindex="-1"></a></span>
<span id="cb1-86"><a href="the-osprey-job-file.html#cb1-86" tabindex="-1"></a></span>
<span id="cb1-87"><a href="the-osprey-job-file.html#cb1-87" tabindex="-1"></a>                                <span class="co">% Specify data scenario</span></span>
<span id="cb1-88"><a href="the-osprey-job-file.html#cb1-88" tabindex="-1"></a>dataScenario <span class="op">=</span> <span class="st">&#39;invivo&#39;</span><span class="op">;</span>        <span class="co">% OPTIONS:    - &#39;invivo&#39; (default)</span></span>
<span id="cb1-89"><a href="the-osprey-job-file.html#cb1-89" tabindex="-1"></a>                                <span class="co">%             - &#39;phantom&#39;</span></span>
<span id="cb1-90"><a href="the-osprey-job-file.html#cb1-90" tabindex="-1"></a>                                <span class="co">%             - &#39;PRIAM&#39;</span></span>
<span id="cb1-91"><a href="the-osprey-job-file.html#cb1-91" tabindex="-1"></a>                                <span class="co">%             - &#39;MRSI&#39;</span></span>
<span id="cb1-92"><a href="the-osprey-job-file.html#cb1-92" tabindex="-1"></a><span class="co">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span>
<span id="cb1-93"><a href="the-osprey-job-file.html#cb1-93" tabindex="-1"></a></span>
<span id="cb1-94"><a href="the-osprey-job-file.html#cb1-94" tabindex="-1"></a></span>
<span id="cb1-95"><a href="the-osprey-job-file.html#cb1-95" tabindex="-1"></a></span>
<span id="cb1-96"><a href="the-osprey-job-file.html#cb1-96" tabindex="-1"></a><span class="co">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span>
<span id="cb1-97"><a href="the-osprey-job-file.html#cb1-97" tabindex="-1"></a><span class="co">%%% 2. SPECIFY DATA HANDLING AND MODELING OPTIONS %%%</span></span>
<span id="cb1-98"><a href="the-osprey-job-file.html#cb1-98" tabindex="-1"></a><span class="co">% Which spectral registration method should be used? Robust spectral</span></span>
<span id="cb1-99"><a href="the-osprey-job-file.html#cb1-99" tabindex="-1"></a><span class="co">% registration is default, a frequency restricted spectral registration</span></span>
<span id="cb1-100"><a href="the-osprey-job-file.html#cb1-100" tabindex="-1"></a><span class="co">% method is also availaible and is linked to the fit range.</span></span>
<span id="cb1-101"><a href="the-osprey-job-file.html#cb1-101" tabindex="-1"></a>opts.SpecReg <span class="op">=</span> <span class="st">&#39;RobSpecReg&#39;</span><span class="op">;</span>                  <span class="co">% OPTIONS:    - &#39;RobSpecReg&#39; (default) Spectral aligment with Water/Lipid removal, using simialrity meric, and weighted averaging</span></span>
<span id="cb1-102"><a href="the-osprey-job-file.html#cb1-102" tabindex="-1"></a>                                              <span class="co">%             - &#39;ProbSpecReg&#39; Probabilistic spectral aligment to median target and weighted averaging</span></span>
<span id="cb1-103"><a href="the-osprey-job-file.html#cb1-103" tabindex="-1"></a>                                              <span class="co">%             - &#39;RestrSpecReg&#39; Frequency restricted (fit range) spectral aligment, using simialrity meric, and weighted averaging</span></span>
<span id="cb1-104"><a href="the-osprey-job-file.html#cb1-104" tabindex="-1"></a>                                              <span class="co">%             - &#39;none&#39;</span></span>
<span id="cb1-105"><a href="the-osprey-job-file.html#cb1-105" tabindex="-1"></a></span>
<span id="cb1-106"><a href="the-osprey-job-file.html#cb1-106" tabindex="-1"></a><span class="co">% Which algorithm do you want to align the sub spectra? L2 norm</span></span>
<span id="cb1-107"><a href="the-osprey-job-file.html#cb1-107" tabindex="-1"></a><span class="co">% optimization is the default. This is only used for edited MRS!</span></span>
<span id="cb1-108"><a href="the-osprey-job-file.html#cb1-108" tabindex="-1"></a><span class="co">%Perform correction on the metabolite data (raw) or metabolite</span></span>
<span id="cb1-109"><a href="the-osprey-job-file.html#cb1-109" tabindex="-1"></a><span class="co">%-nulled data (mm).</span></span>
<span id="cb1-110"><a href="the-osprey-job-file.html#cb1-110" tabindex="-1"></a>opts.SubSpecAlignment.mets <span class="op">=</span> <span class="st">&#39;L2Norm&#39;</span><span class="op">;</span>          <span class="co">% OPTIONS:    - &#39;L2Norm&#39; (default)</span></span>
<span id="cb1-111"><a href="the-osprey-job-file.html#cb1-111" tabindex="-1"></a>                                                <span class="co">%             - &#39;L1Norm&#39;</span></span>
<span id="cb1-112"><a href="the-osprey-job-file.html#cb1-112" tabindex="-1"></a>                                                <span class="co">%             - &#39;none&#39;</span></span>
<span id="cb1-113"><a href="the-osprey-job-file.html#cb1-113" tabindex="-1"></a></span>
<span id="cb1-114"><a href="the-osprey-job-file.html#cb1-114" tabindex="-1"></a><span class="co">%Perform eddy-current correction on the metabolite data (raw) or metabolite</span></span>
<span id="cb1-115"><a href="the-osprey-job-file.html#cb1-115" tabindex="-1"></a><span class="co">%-nulled data (mm). This can either be done similar for all data sets by</span></span>
<span id="cb1-116"><a href="the-osprey-job-file.html#cb1-116" tabindex="-1"></a><span class="co">%supplying a single value or specified for each dataset individually by supplying</span></span>
<span id="cb1-117"><a href="the-osprey-job-file.html#cb1-117" tabindex="-1"></a><span class="co">% multiple entries (number has to match the number of datasets) e.g. to perform ECC</span></span>
<span id="cb1-118"><a href="the-osprey-job-file.html#cb1-118" tabindex="-1"></a><span class="co">% for the second dataset only:</span></span>
<span id="cb1-119"><a href="the-osprey-job-file.html#cb1-119" tabindex="-1"></a><span class="co">% opts.ECC.raw               = [0 1];</span></span>
<span id="cb1-120"><a href="the-osprey-job-file.html#cb1-120" tabindex="-1"></a><span class="co">% opts.ECC.mm                = [0 1];</span></span>
<span id="cb1-121"><a href="the-osprey-job-file.html#cb1-121" tabindex="-1"></a></span>
<span id="cb1-122"><a href="the-osprey-job-file.html#cb1-122" tabindex="-1"></a></span>
<span id="cb1-123"><a href="the-osprey-job-file.html#cb1-123" tabindex="-1"></a>opts.ECC.raw                <span class="op">=</span> <span class="fl">1</span><span class="op">;</span>                <span class="co">% OPTIONS:    - &#39;1&#39; (default)</span></span>
<span id="cb1-124"><a href="the-osprey-job-file.html#cb1-124" tabindex="-1"></a>opts.ECC.mm                <span class="op">=</span> <span class="fl">1</span><span class="op">;</span>                 <span class="co">%             - &#39;0&#39; (no)</span></span>
<span id="cb1-125"><a href="the-osprey-job-file.html#cb1-125" tabindex="-1"></a>                                                <span class="co">%             - [] array</span></span>
<span id="cb1-126"><a href="the-osprey-job-file.html#cb1-126" tabindex="-1"></a></span>
<span id="cb1-127"><a href="the-osprey-job-file.html#cb1-127" tabindex="-1"></a></span>
<span id="cb1-128"><a href="the-osprey-job-file.html#cb1-128" tabindex="-1"></a><span class="co">% Save LCModel-exportable files for each spectrum?</span></span>
<span id="cb1-129"><a href="the-osprey-job-file.html#cb1-129" tabindex="-1"></a>opts.saveLCM                <span class="op">=</span> <span class="fl">1</span><span class="op">;</span>                <span class="co">% OPTIONS:    - 0 (no, default)</span></span>
<span id="cb1-130"><a href="the-osprey-job-file.html#cb1-130" tabindex="-1"></a>                                                <span class="co">%             - 1 (yes)</span></span>
<span id="cb1-131"><a href="the-osprey-job-file.html#cb1-131" tabindex="-1"></a><span class="co">% Save jMRUI-exportable files for each spectrum?</span></span>
<span id="cb1-132"><a href="the-osprey-job-file.html#cb1-132" tabindex="-1"></a>opts.savejMRUI              <span class="op">=</span> <span class="fl">1</span><span class="op">;</span>                <span class="co">% OPTIONS:    - 0 (no, default)</span></span>
<span id="cb1-133"><a href="the-osprey-job-file.html#cb1-133" tabindex="-1"></a>                                                <span class="co">%             - 1 (yes)</span></span>
<span id="cb1-134"><a href="the-osprey-job-file.html#cb1-134" tabindex="-1"></a></span>
<span id="cb1-135"><a href="the-osprey-job-file.html#cb1-135" tabindex="-1"></a><span class="co">% Save processed spectra in vendor-specific format (SDAT/SPAR, RDA, P)?</span></span>
<span id="cb1-136"><a href="the-osprey-job-file.html#cb1-136" tabindex="-1"></a>opts.saveVendor             <span class="op">=</span> <span class="fl">1</span><span class="op">;</span>                <span class="co">% OPTIONS:    - 0 (no, default)</span></span>
<span id="cb1-137"><a href="the-osprey-job-file.html#cb1-137" tabindex="-1"></a>                                                <span class="co">%             - 1 (yes)</span></span>
<span id="cb1-138"><a href="the-osprey-job-file.html#cb1-138" tabindex="-1"></a></span>
<span id="cb1-139"><a href="the-osprey-job-file.html#cb1-139" tabindex="-1"></a><span class="co">% Save processed spectra in NIfTI-MRS format?</span></span>
<span id="cb1-140"><a href="the-osprey-job-file.html#cb1-140" tabindex="-1"></a>opts.saveNII                <span class="op">=</span> <span class="fl">0</span><span class="op">;</span>                <span class="co">% OPTIONS:    - 0 (no, default)</span></span>
<span id="cb1-141"><a href="the-osprey-job-file.html#cb1-141" tabindex="-1"></a>                                                <span class="co">%             - 1 (yes)</span></span>
<span id="cb1-142"><a href="the-osprey-job-file.html#cb1-142" tabindex="-1"></a></span>
<span id="cb1-143"><a href="the-osprey-job-file.html#cb1-143" tabindex="-1"></a><span class="co">% Save PDF output for all Osprey modules and subjects?</span></span>
<span id="cb1-144"><a href="the-osprey-job-file.html#cb1-144" tabindex="-1"></a>opts.savePDF                <span class="op">=</span> <span class="fl">0</span><span class="op">;</span>                <span class="co">% OPTIONS:    - 0 (no, default)</span></span>
<span id="cb1-145"><a href="the-osprey-job-file.html#cb1-145" tabindex="-1"></a>                                                <span class="co">%             - 1 (yes)</span></span>
<span id="cb1-146"><a href="the-osprey-job-file.html#cb1-146" tabindex="-1"></a></span>
<span id="cb1-147"><a href="the-osprey-job-file.html#cb1-147" tabindex="-1"></a><span class="co">% Select the metabolites to be included in the basis set as a cell array,</span></span>
<span id="cb1-148"><a href="the-osprey-job-file.html#cb1-148" tabindex="-1"></a><span class="co">% with entries separates by commas.</span></span>
<span id="cb1-149"><a href="the-osprey-job-file.html#cb1-149" tabindex="-1"></a><span class="co">% With default Osprey basis sets, you can select the following metabolites:</span></span>
<span id="cb1-150"><a href="the-osprey-job-file.html#cb1-150" tabindex="-1"></a><span class="co">% Ala, Asc, Asp, bHB, bHG, Cit, Cr, Cystat, CrCH2, EtOH, GABA, GPC, GSH, Glc, Gln,</span></span>
<span id="cb1-151"><a href="the-osprey-job-file.html#cb1-151" tabindex="-1"></a><span class="co">% Glu, Gly, H2O, mI, Lac, NAA, NAAG, PCh, PCr, PE, Phenyl, sI, Ser,</span></span>
<span id="cb1-152"><a href="the-osprey-job-file.html#cb1-152" tabindex="-1"></a><span class="co">% Tau, Tyros, MM09, MM12, MM14, MM17, MM20, Lip09, Lip13, Lip20.</span></span>
<span id="cb1-153"><a href="the-osprey-job-file.html#cb1-153" tabindex="-1"></a><span class="co">% If you enter &#39;default&#39;, the basis set will include all of the above</span></span>
<span id="cb1-154"><a href="the-osprey-job-file.html#cb1-154" tabindex="-1"></a><span class="co">% except for Ala, bHB, bHG, Cit, Cystat, EtOH, Glc, Gly, Phenyl, Ser, and Tyros.</span></span>
<span id="cb1-155"><a href="the-osprey-job-file.html#cb1-155" tabindex="-1"></a>opts.fit.includeMetabs      <span class="op">=</span> {<span class="st">&#39;default&#39;</span>}<span class="op">;</span>      <span class="co">% OPTIONS:    - {&#39;default&#39;}</span></span>
<span id="cb1-156"><a href="the-osprey-job-file.html#cb1-156" tabindex="-1"></a>                                                <span class="co">%             - {custom}</span></span>
<span id="cb1-157"><a href="the-osprey-job-file.html#cb1-157" tabindex="-1"></a></span>
<span id="cb1-158"><a href="the-osprey-job-file.html#cb1-158" tabindex="-1"></a><span class="co">% Choose the fitting algorithm</span></span>
<span id="cb1-159"><a href="the-osprey-job-file.html#cb1-159" tabindex="-1"></a>opts.fit.method             <span class="op">=</span> <span class="st">&#39;Osprey&#39;</span><span class="op">;</span>         <span class="co">% OPTIONS:    - &#39;Osprey&#39; (default)</span></span>
<span id="cb1-160"><a href="the-osprey-job-file.html#cb1-160" tabindex="-1"></a>                                                <span class="co">%           - &#39;LCModel&#39;</span></span>
<span id="cb1-161"><a href="the-osprey-job-file.html#cb1-161" tabindex="-1"></a></span>
<span id="cb1-162"><a href="the-osprey-job-file.html#cb1-162" tabindex="-1"></a><span class="co">% Choose the fitting style for difference-edited datasets (MEGA, HERMES, HERCULES)</span></span>
<span id="cb1-163"><a href="the-osprey-job-file.html#cb1-163" tabindex="-1"></a><span class="co">% (only available for the Osprey fitting method)</span></span>
<span id="cb1-164"><a href="the-osprey-job-file.html#cb1-164" tabindex="-1"></a>opts.fit.style              <span class="op">=</span> <span class="st">&#39;Separate&#39;</span><span class="op">;</span>       <span class="co">% OPTIONS:  - &#39;Concatenated&#39; (default) - will fit DIFF and SUM simultaneously)</span></span>
<span id="cb1-165"><a href="the-osprey-job-file.html#cb1-165" tabindex="-1"></a>                                                <span class="co">%           - &#39;Separate&#39; - will fit DIFF and OFF separately</span></span>
<span id="cb1-166"><a href="the-osprey-job-file.html#cb1-166" tabindex="-1"></a></span>
<span id="cb1-167"><a href="the-osprey-job-file.html#cb1-167" tabindex="-1"></a><span class="co">% Determine fitting range (in ppm) for the metabolite and water spectra</span></span>
<span id="cb1-168"><a href="the-osprey-job-file.html#cb1-168" tabindex="-1"></a>opts.fit.range              <span class="op">=</span> [<span class="fl">0.5</span> <span class="fl">4</span>]<span class="op">;</span>          <span class="co">% [ppm] Default: [0.5 4]</span></span>
<span id="cb1-169"><a href="the-osprey-job-file.html#cb1-169" tabindex="-1"></a>opts.fit.rangeWater         <span class="op">=</span> [<span class="fl">2.0</span> <span class="fl">7.4</span>]<span class="op">;</span>        <span class="co">% [ppm] Default: [2.0 7.4]</span></span>
<span id="cb1-170"><a href="the-osprey-job-file.html#cb1-170" tabindex="-1"></a></span>
<span id="cb1-171"><a href="the-osprey-job-file.html#cb1-171" tabindex="-1"></a><span class="co">% Determine the baseline knot spacing (in ppm) for the metabolite spectra</span></span>
<span id="cb1-172"><a href="the-osprey-job-file.html#cb1-172" tabindex="-1"></a>opts.fit.bLineKnotSpace     <span class="op">=</span> <span class="fl">0.4</span><span class="op">;</span>              <span class="co">% [ppm] Default: 0.4.</span></span>
<span id="cb1-173"><a href="the-osprey-job-file.html#cb1-173" tabindex="-1"></a></span>
<span id="cb1-174"><a href="the-osprey-job-file.html#cb1-174" tabindex="-1"></a><span class="co">% Add macromolecule and lipid basis functions to the fit?</span></span>
<span id="cb1-175"><a href="the-osprey-job-file.html#cb1-175" tabindex="-1"></a>opts.fit.fitMM              <span class="op">=</span> <span class="fl">1</span><span class="op">;</span>                <span class="co">% OPTIONS:    - 0 (no)</span></span>
<span id="cb1-176"><a href="the-osprey-job-file.html#cb1-176" tabindex="-1"></a>                                                <span class="co">%             - 1 (yes, default)</span></span>
<span id="cb1-177"><a href="the-osprey-job-file.html#cb1-177" tabindex="-1"></a>                                                </span>
<span id="cb1-178"><a href="the-osprey-job-file.html#cb1-178" tabindex="-1"></a><span class="co">% Optional: In case the automatic basisset picker is not working you can manually</span></span>
<span id="cb1-179"><a href="the-osprey-job-file.html#cb1-179" tabindex="-1"></a><span class="co">% select the path to the basis set in the osprey/fit/basis, i.e.:</span></span>
<span id="cb1-180"><a href="the-osprey-job-file.html#cb1-180" tabindex="-1"></a><span class="co">% opts.fit.basisSetFile = &#39;osprey/fit/basis/3T/philips/mega/press/gaba68/basis_philips_megapress_gaba68.mat&#39;;</span></span>
<span id="cb1-181"><a href="the-osprey-job-file.html#cb1-181" tabindex="-1"></a><span class="co">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span>
<span id="cb1-182"><a href="the-osprey-job-file.html#cb1-182" tabindex="-1"></a></span>
<span id="cb1-183"><a href="the-osprey-job-file.html#cb1-183" tabindex="-1"></a></span>
<span id="cb1-184"><a href="the-osprey-job-file.html#cb1-184" tabindex="-1"></a></span>
<span id="cb1-185"><a href="the-osprey-job-file.html#cb1-185" tabindex="-1"></a><span class="co">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span>
<span id="cb1-186"><a href="the-osprey-job-file.html#cb1-186" tabindex="-1"></a><span class="co">%%% 3. SPECIFY MRS DATA AND STRUCTURAL IMAGING FILES %%</span></span>
<span id="cb1-187"><a href="the-osprey-job-file.html#cb1-187" tabindex="-1"></a><span class="co">% When using single-average Siemens RDA or DICOM files, specify their</span></span>
<span id="cb1-188"><a href="the-osprey-job-file.html#cb1-188" tabindex="-1"></a><span class="co">% folders instead of single files!</span></span>
<span id="cb1-189"><a href="the-osprey-job-file.html#cb1-189" tabindex="-1"></a></span>
<span id="cb1-190"><a href="the-osprey-job-file.html#cb1-190" tabindex="-1"></a><span class="co">% Clear existing files</span></span>
<span id="cb1-191"><a href="the-osprey-job-file.html#cb1-191" tabindex="-1"></a><span class="bu">clear</span> files files_ref files_w files_nii files_mm</span>
<span id="cb1-192"><a href="the-osprey-job-file.html#cb1-192" tabindex="-1"></a></span>
<span id="cb1-193"><a href="the-osprey-job-file.html#cb1-193" tabindex="-1"></a><span class="co">% Data folder in BIDS format</span></span>
<span id="cb1-194"><a href="the-osprey-job-file.html#cb1-194" tabindex="-1"></a><span class="co">% The filparts(which()) comment is needed to find the data on your machine. If you set</span></span>
<span id="cb1-195"><a href="the-osprey-job-file.html#cb1-195" tabindex="-1"></a><span class="co">% up the jobFile for your own data you can set a direct path to your data</span></span>
<span id="cb1-196"><a href="the-osprey-job-file.html#cb1-196" tabindex="-1"></a><span class="co">% folder e.g., data_folder = /Volumes/MyProject/data/&#39;</span></span>
<span id="cb1-197"><a href="the-osprey-job-file.html#cb1-197" tabindex="-1"></a></span>
<span id="cb1-198"><a href="the-osprey-job-file.html#cb1-198" tabindex="-1"></a>data_folder <span class="op">=</span> <span class="fu">fileparts</span>(<span class="fu">which</span>(<span class="fu">fullfile</span>(<span class="st">&#39;exampledata&#39;</span><span class="op">,</span><span class="st">&#39;sdat&#39;</span><span class="op">,</span><span class="st">&#39;UnEdited&#39;</span><span class="op">,</span><span class="st">&#39;jobSDAT.m&#39;</span>)))<span class="op">;</span></span>
<span id="cb1-199"><a href="the-osprey-job-file.html#cb1-199" tabindex="-1"></a></span>
<span id="cb1-200"><a href="the-osprey-job-file.html#cb1-200" tabindex="-1"></a><span class="co">% The following lines perform an automated set-up of the jobFile which</span></span>
<span id="cb1-201"><a href="the-osprey-job-file.html#cb1-201" tabindex="-1"></a><span class="co">% takes advatage of the BIDS foramt. If you are not using BIDS (highly</span></span>
<span id="cb1-202"><a href="the-osprey-job-file.html#cb1-202" tabindex="-1"></a><span class="co">% recommended) you can look at the definitions below the loop to see how to</span></span>
<span id="cb1-203"><a href="the-osprey-job-file.html#cb1-203" tabindex="-1"></a><span class="co">% set up direct path links to your data.</span></span>
<span id="cb1-204"><a href="the-osprey-job-file.html#cb1-204" tabindex="-1"></a></span>
<span id="cb1-205"><a href="the-osprey-job-file.html#cb1-205" tabindex="-1"></a>subs       <span class="op">=</span> <span class="fu">dir</span>(data_folder)<span class="op">;</span></span>
<span id="cb1-206"><a href="the-osprey-job-file.html#cb1-206" tabindex="-1"></a>subs(<span class="fl">1</span><span class="op">:</span><span class="fl">2</span>)  <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-207"><a href="the-osprey-job-file.html#cb1-207" tabindex="-1"></a>subs       <span class="op">=</span> subs([subs.isdir])<span class="op">;</span></span>
<span id="cb1-208"><a href="the-osprey-job-file.html#cb1-208" tabindex="-1"></a>subs       <span class="op">=</span> subs(contains({subs.name}<span class="op">,</span><span class="st">&#39;sub&#39;</span>))<span class="op">;</span></span>
<span id="cb1-209"><a href="the-osprey-job-file.html#cb1-209" tabindex="-1"></a>counter    <span class="op">=</span> <span class="fl">1</span><span class="op">;</span></span>
<span id="cb1-210"><a href="the-osprey-job-file.html#cb1-210" tabindex="-1"></a></span>
<span id="cb1-211"><a href="the-osprey-job-file.html#cb1-211" tabindex="-1"></a><span class="cf">for</span> kk <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(subs)</span>
<span id="cb1-212"><a href="the-osprey-job-file.html#cb1-212" tabindex="-1"></a>    <span class="co">% Loop over sessions</span></span>
<span id="cb1-213"><a href="the-osprey-job-file.html#cb1-213" tabindex="-1"></a>    sess        <span class="op">=</span> <span class="fu">dir</span>([subs(kk).folder <span class="fu">filesep</span> subs(kk).name])<span class="op">;</span></span>
<span id="cb1-214"><a href="the-osprey-job-file.html#cb1-214" tabindex="-1"></a>    sess(<span class="fl">1</span><span class="op">:</span><span class="fl">2</span>)   <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-215"><a href="the-osprey-job-file.html#cb1-215" tabindex="-1"></a>    sess        <span class="op">=</span> sess([sess.isdir])<span class="op">;</span></span>
<span id="cb1-216"><a href="the-osprey-job-file.html#cb1-216" tabindex="-1"></a>    sess        <span class="op">=</span> sess(contains({sess.name}<span class="op">,</span><span class="st">&#39;ses&#39;</span>))<span class="op">;</span></span>
<span id="cb1-217"><a href="the-osprey-job-file.html#cb1-217" tabindex="-1"></a>    <span class="cf">for</span> ll <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(sess)</span>
<span id="cb1-218"><a href="the-osprey-job-file.html#cb1-218" tabindex="-1"></a></span>
<span id="cb1-219"><a href="the-osprey-job-file.html#cb1-219" tabindex="-1"></a>        <span class="co">% Specify metabolite data</span></span>
<span id="cb1-220"><a href="the-osprey-job-file.html#cb1-220" tabindex="-1"></a>        <span class="co">% (MANDATORY)</span></span>
<span id="cb1-221"><a href="the-osprey-job-file.html#cb1-221" tabindex="-1"></a>        dir_metabolite    <span class="op">=</span> <span class="fu">dir</span>([sess(ll).folder <span class="fu">filesep</span> sess(ll).name <span class="fu">filesep</span> <span class="st">&#39;mrs&#39;</span> <span class="fu">filesep</span> subs(kk).name <span class="st">&#39;_&#39;</span> sess(ll).name <span class="st">&#39;_press&#39;</span> <span class="fu">filesep</span> <span class="st">&#39;*.SDAT&#39;</span>])<span class="op">;</span></span>
<span id="cb1-222"><a href="the-osprey-job-file.html#cb1-222" tabindex="-1"></a>        files(counter)      <span class="op">=</span> {[dir_metabolite(<span class="cf">end</span>).folder <span class="fu">filesep</span> dir_metabolite(<span class="cf">end</span>).name]}<span class="op">;</span></span>
<span id="cb1-223"><a href="the-osprey-job-file.html#cb1-223" tabindex="-1"></a></span>
<span id="cb1-224"><a href="the-osprey-job-file.html#cb1-224" tabindex="-1"></a>        <span class="co">% Specify water reference data for eddy-current correction (same sequence as metabolite data!)</span></span>
<span id="cb1-225"><a href="the-osprey-job-file.html#cb1-225" tabindex="-1"></a>        <span class="co">% (OPTIONAL)</span></span>
<span id="cb1-226"><a href="the-osprey-job-file.html#cb1-226" tabindex="-1"></a>        <span class="co">% Leave empty for GE P-files (.7) - these include water reference data by</span></span>
<span id="cb1-227"><a href="the-osprey-job-file.html#cb1-227" tabindex="-1"></a>        <span class="co">% default.</span></span>
<span id="cb1-228"><a href="the-osprey-job-file.html#cb1-228" tabindex="-1"></a>        dir_ref    <span class="op">=</span> <span class="fu">dir</span>([sess(ll).folder <span class="fu">filesep</span> sess(ll).name <span class="fu">filesep</span> <span class="st">&#39;mrs&#39;</span> <span class="fu">filesep</span> subs(kk).name <span class="st">&#39;_&#39;</span> sess(ll).name <span class="st">&#39;_press-ref&#39;</span> <span class="fu">filesep</span> <span class="st">&#39;*.SDAT&#39;</span>])<span class="op">;</span></span>
<span id="cb1-229"><a href="the-osprey-job-file.html#cb1-229" tabindex="-1"></a>        files_ref(counter)  <span class="op">=</span> {[dir_ref(<span class="cf">end</span>).folder <span class="fu">filesep</span> dir_ref(<span class="cf">end</span>).name]}<span class="op">;</span></span>
<span id="cb1-230"><a href="the-osprey-job-file.html#cb1-230" tabindex="-1"></a></span>
<span id="cb1-231"><a href="the-osprey-job-file.html#cb1-231" tabindex="-1"></a>        <span class="co">% Specify water data for quantification (e.g. short-TE water scan)</span></span>
<span id="cb1-232"><a href="the-osprey-job-file.html#cb1-232" tabindex="-1"></a>        <span class="co">% (OPTIONAL)</span></span>
<span id="cb1-233"><a href="the-osprey-job-file.html#cb1-233" tabindex="-1"></a>        files_w     <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb1-234"><a href="the-osprey-job-file.html#cb1-234" tabindex="-1"></a></span>
<span id="cb1-235"><a href="the-osprey-job-file.html#cb1-235" tabindex="-1"></a>        <span class="co">% Specify metabolite-nulled data for quantification</span></span>
<span id="cb1-236"><a href="the-osprey-job-file.html#cb1-236" tabindex="-1"></a>        <span class="co">% (OPTIONAL)</span></span>
<span id="cb1-237"><a href="the-osprey-job-file.html#cb1-237" tabindex="-1"></a>        files_mm     <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb1-238"><a href="the-osprey-job-file.html#cb1-238" tabindex="-1"></a></span>
<span id="cb1-239"><a href="the-osprey-job-file.html#cb1-239" tabindex="-1"></a>       <span class="co">% Specify T1-weighted structural imaging data</span></span>
<span id="cb1-240"><a href="the-osprey-job-file.html#cb1-240" tabindex="-1"></a>        <span class="co">% (OPTIONAL)</span></span>
<span id="cb1-241"><a href="the-osprey-job-file.html#cb1-241" tabindex="-1"></a>        <span class="co">% Link to single NIfTI (*.nii) files for Siemens and Philips data</span></span>
<span id="cb1-242"><a href="the-osprey-job-file.html#cb1-242" tabindex="-1"></a>        <span class="co">% Link to DICOM (*.dcm) folders for GE data</span></span>
<span id="cb1-243"><a href="the-osprey-job-file.html#cb1-243" tabindex="-1"></a>        files_nii(counter)  <span class="op">=</span> {[sess(ll).folder <span class="fu">filesep</span> sess(ll).name <span class="fu">filesep</span> <span class="st">&#39;anat&#39;</span> <span class="fu">filesep</span> subs(kk).name <span class="fu">filesep</span> sess(ll).name <span class="st">&#39;_T1w.nii.gz&#39;</span>]}<span class="op">;</span></span>
<span id="cb1-244"><a href="the-osprey-job-file.html#cb1-244" tabindex="-1"></a></span>
<span id="cb1-245"><a href="the-osprey-job-file.html#cb1-245" tabindex="-1"></a>        <span class="co">% External segmentation results</span></span>
<span id="cb1-246"><a href="the-osprey-job-file.html#cb1-246" tabindex="-1"></a>        <span class="co">% (OPTIONAL)</span></span>
<span id="cb1-247"><a href="the-osprey-job-file.html#cb1-247" tabindex="-1"></a>        <span class="co">% Link to NIfTI (*.nii or *.nii.gz) files with segmentation results</span></span>
<span id="cb1-248"><a href="the-osprey-job-file.html#cb1-248" tabindex="-1"></a>        <span class="co">% Add supply gray matter, white matter, and CSF as 1 x 3 cell within a</span></span>
<span id="cb1-249"><a href="the-osprey-job-file.html#cb1-249" tabindex="-1"></a>        <span class="co">% cell array  or a single 4D file in the same order supplied as 1 x 1 cell;</span></span>
<span id="cb1-250"><a href="the-osprey-job-file.html#cb1-250" tabindex="-1"></a><span class="co">%         files_seg(counter)   = {{[sess(ll).folder filesep sess(ll).name filesep &#39;anat&#39; filesep subs(kk).name filesep &#39;c1&#39; sess(ll).name &#39;_T1w.nii.gz&#39;],...</span></span>
<span id="cb1-251"><a href="the-osprey-job-file.html#cb1-251" tabindex="-1"></a><span class="co">%                                  [sess(ll).folder filesep sess(ll).name filesep &#39;anat&#39; filesep subs(kk).name filesep &#39;c2&#39; sess(ll).name &#39;_T1w.nii.gz&#39;],...</span></span>
<span id="cb1-252"><a href="the-osprey-job-file.html#cb1-252" tabindex="-1"></a><span class="co">%                                  [sess(ll).folder filesep sess(ll).name filesep &#39;anat&#39; filesep subs(kk).name filesep &#39;c3&#39; sess(ll).name &#39;_T1w.nii.gz&#39;]}};</span></span>
<span id="cb1-253"><a href="the-osprey-job-file.html#cb1-253" tabindex="-1"></a></span>
<span id="cb1-254"><a href="the-osprey-job-file.html#cb1-254" tabindex="-1"></a><span class="co">%         files_seg(counter)   = {{[sess(ll).folder filesep sess(ll).name filesep &#39;anat&#39; filesep subs(kk).name filesep &#39;4D&#39; sess(ll).name &#39;_T1w.nii.gz&#39;]}};</span></span>
<span id="cb1-255"><a href="the-osprey-job-file.html#cb1-255" tabindex="-1"></a></span>
<span id="cb1-256"><a href="the-osprey-job-file.html#cb1-256" tabindex="-1"></a>        counter             <span class="op">=</span> counter <span class="op">+</span> <span class="fl">1</span><span class="op">;</span></span>
<span id="cb1-257"><a href="the-osprey-job-file.html#cb1-257" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb1-258"><a href="the-osprey-job-file.html#cb1-258" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb1-259"><a href="the-osprey-job-file.html#cb1-259" tabindex="-1"></a></span>
<span id="cb1-260"><a href="the-osprey-job-file.html#cb1-260" tabindex="-1"></a><span class="co">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span>
<span id="cb1-261"><a href="the-osprey-job-file.html#cb1-261" tabindex="-1"></a><span class="co">% Definitions without using BIDS</span></span>
<span id="cb1-262"><a href="the-osprey-job-file.html#cb1-262" tabindex="-1"></a></span>
<span id="cb1-263"><a href="the-osprey-job-file.html#cb1-263" tabindex="-1"></a><span class="co">% You can always supply direct path to each of the files within</span></span>
<span id="cb1-264"><a href="the-osprey-job-file.html#cb1-264" tabindex="-1"></a><span class="co">% the cell array. For example:</span></span>
<span id="cb1-265"><a href="the-osprey-job-file.html#cb1-265" tabindex="-1"></a></span>
<span id="cb1-266"><a href="the-osprey-job-file.html#cb1-266" tabindex="-1"></a><span class="co">% Specify metabolite data</span></span>
<span id="cb1-267"><a href="the-osprey-job-file.html#cb1-267" tabindex="-1"></a><span class="co">% (MANDATORY)</span></span>
<span id="cb1-268"><a href="the-osprey-job-file.html#cb1-268" tabindex="-1"></a><span class="co">% files(counter)      = {&#39;/Volumes/MyProject/data/sub-01/mrs/PRESS_act.SDAT&#39;,...</span></span>
<span id="cb1-269"><a href="the-osprey-job-file.html#cb1-269" tabindex="-1"></a><span class="co">%                        &#39;/Volumes/MyProject/data/sub-02/mrs/PRESS_act.SDAT&#39;};</span></span>
<span id="cb1-270"><a href="the-osprey-job-file.html#cb1-270" tabindex="-1"></a></span>
<span id="cb1-271"><a href="the-osprey-job-file.html#cb1-271" tabindex="-1"></a><span class="co">% Specify water reference data for eddy-current correction (same sequence as metabolite data!)</span></span>
<span id="cb1-272"><a href="the-osprey-job-file.html#cb1-272" tabindex="-1"></a><span class="co">% (OPTIONAL)</span></span>
<span id="cb1-273"><a href="the-osprey-job-file.html#cb1-273" tabindex="-1"></a><span class="co">% Leave empty for GE P-files (.7) - these include water reference data by</span></span>
<span id="cb1-274"><a href="the-osprey-job-file.html#cb1-274" tabindex="-1"></a><span class="co">% default.</span></span>
<span id="cb1-275"><a href="the-osprey-job-file.html#cb1-275" tabindex="-1"></a><span class="co">% files_ref(counter)      = {&#39;/Volumes/MyProject/data/sub-01/mrs/PRESS_ref.SDAT&#39;,...</span></span>
<span id="cb1-276"><a href="the-osprey-job-file.html#cb1-276" tabindex="-1"></a><span class="co">%                            &#39;/Volumes/MyProject/data/sub-02/mrs/PRESS_ref.SDAT&#39;};</span></span>
<span id="cb1-277"><a href="the-osprey-job-file.html#cb1-277" tabindex="-1"></a></span>
<span id="cb1-278"><a href="the-osprey-job-file.html#cb1-278" tabindex="-1"></a><span class="co">% Specify water data for quantification (e.g. short-TE water scan)</span></span>
<span id="cb1-279"><a href="the-osprey-job-file.html#cb1-279" tabindex="-1"></a><span class="co">% (OPTIONAL)</span></span>
<span id="cb1-280"><a href="the-osprey-job-file.html#cb1-280" tabindex="-1"></a><span class="co">% files_w     = {};</span></span>
<span id="cb1-281"><a href="the-osprey-job-file.html#cb1-281" tabindex="-1"></a></span>
<span id="cb1-282"><a href="the-osprey-job-file.html#cb1-282" tabindex="-1"></a><span class="co">% Specify metabolite-nulled data for quantification</span></span>
<span id="cb1-283"><a href="the-osprey-job-file.html#cb1-283" tabindex="-1"></a><span class="co">% (OPTIONAL)</span></span>
<span id="cb1-284"><a href="the-osprey-job-file.html#cb1-284" tabindex="-1"></a><span class="co">% files_mm     = {};</span></span>
<span id="cb1-285"><a href="the-osprey-job-file.html#cb1-285" tabindex="-1"></a></span>
<span id="cb1-286"><a href="the-osprey-job-file.html#cb1-286" tabindex="-1"></a><span class="co">% Specify T1-weighted structural imaging data</span></span>
<span id="cb1-287"><a href="the-osprey-job-file.html#cb1-287" tabindex="-1"></a><span class="co">% (OPTIONAL)</span></span>
<span id="cb1-288"><a href="the-osprey-job-file.html#cb1-288" tabindex="-1"></a><span class="co">% Link to single NIfTI (*.nii.gz or #.nii) files for GE, Siemens and Philips data</span></span>
<span id="cb1-289"><a href="the-osprey-job-file.html#cb1-289" tabindex="-1"></a><span class="co">% files_nii  = {&#39;/Volumes/MyProject/data/sub-01/anat/T1w.nii.gz&#39;,...</span></span>
<span id="cb1-290"><a href="the-osprey-job-file.html#cb1-290" tabindex="-1"></a><span class="co">%               &#39;/Volumes/MyProject/data/sub-02/anat/T1w.nii.gz&#39;};</span></span>
<span id="cb1-291"><a href="the-osprey-job-file.html#cb1-291" tabindex="-1"></a></span>
<span id="cb1-292"><a href="the-osprey-job-file.html#cb1-292" tabindex="-1"></a><span class="co">% External segmentation results</span></span>
<span id="cb1-293"><a href="the-osprey-job-file.html#cb1-293" tabindex="-1"></a><span class="co">% (OPTIONAL)</span></span>
<span id="cb1-294"><a href="the-osprey-job-file.html#cb1-294" tabindex="-1"></a><span class="co">% Link to NIfTI (*.nii or *.nii.gz) files with segmentation results</span></span>
<span id="cb1-295"><a href="the-osprey-job-file.html#cb1-295" tabindex="-1"></a><span class="co">% Add supply gray matter, white matter, and CSF as 1 x 3 cell within a</span></span>
<span id="cb1-296"><a href="the-osprey-job-file.html#cb1-296" tabindex="-1"></a><span class="co">% cell array  or a single 4D file in the same order supplied as 1 x 1 cell;</span></span>
<span id="cb1-297"><a href="the-osprey-job-file.html#cb1-297" tabindex="-1"></a><span class="co">%         files_seg(counter)   = {{&#39;/Volumes/MyProject/data/sub-01/anat/c1T1w.nii.gz&#39;,...</span></span>
<span id="cb1-298"><a href="the-osprey-job-file.html#cb1-298" tabindex="-1"></a><span class="co">%                                  &#39;/Volumes/MyProject/data/sub-01/anat/c2T1w.nii.gz&#39;,...</span></span>
<span id="cb1-299"><a href="the-osprey-job-file.html#cb1-299" tabindex="-1"></a><span class="co">%                                  &#39;/Volumes/MyProject/data/sub-01/anat/c3T1w.nii.gz&#39;},...</span></span>
<span id="cb1-300"><a href="the-osprey-job-file.html#cb1-300" tabindex="-1"></a><span class="co">%                                   {&#39;/Volumes/MyProject/data/sub-02/anat/c1T1w.nii.gz&#39;,...</span></span>
<span id="cb1-301"><a href="the-osprey-job-file.html#cb1-301" tabindex="-1"></a><span class="co">%                                  &#39;/Volumes/MyProject/data/sub-02/anat/c2T1w.nii.gz&#39;,...</span></span>
<span id="cb1-302"><a href="the-osprey-job-file.html#cb1-302" tabindex="-1"></a><span class="co">%                                  &#39;/Volumes/MyProject/data/sub-02/anat/c3T1w.nii.gz&#39;}};</span></span>
<span id="cb1-303"><a href="the-osprey-job-file.html#cb1-303" tabindex="-1"></a><span class="co">%         files_seg(counter)   = {{&#39;/Volumes/MyProject/data/sub-01/anat/4DT1w.nii.gz&#39;},...</span></span>
<span id="cb1-304"><a href="the-osprey-job-file.html#cb1-304" tabindex="-1"></a><span class="co">%                                   {&#39;/Volumes/MyProject/data/sub-02/anat/4DT1w.nii.gz&#39;}};</span></span>
<span id="cb1-305"><a href="the-osprey-job-file.html#cb1-305" tabindex="-1"></a></span>
<span id="cb1-306"><a href="the-osprey-job-file.html#cb1-306" tabindex="-1"></a><span class="co">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span>
<span id="cb1-307"><a href="the-osprey-job-file.html#cb1-307" tabindex="-1"></a><span class="co">%%% 4. SPECIFY STAT FILE %%%</span></span>
<span id="cb1-308"><a href="the-osprey-job-file.html#cb1-308" tabindex="-1"></a><span class="co">% Supply location of a csv file, which contains possible correlation</span></span>
<span id="cb1-309"><a href="the-osprey-job-file.html#cb1-309" tabindex="-1"></a><span class="co">% measures and group variables. Each column must start with the name of the</span></span>
<span id="cb1-310"><a href="the-osprey-job-file.html#cb1-310" tabindex="-1"></a><span class="co">% measure. For the grouping variable use &#39;group&#39; and numbers between 1 and</span></span>
<span id="cb1-311"><a href="the-osprey-job-file.html#cb1-311" tabindex="-1"></a><span class="co">% the number of included groups. If no group is supplied the data will be</span></span>
<span id="cb1-312"><a href="the-osprey-job-file.html#cb1-312" tabindex="-1"></a><span class="co">% treated as one group. (You can always use the direct path)</span></span>
<span id="cb1-313"><a href="the-osprey-job-file.html#cb1-313" tabindex="-1"></a></span>
<span id="cb1-314"><a href="the-osprey-job-file.html#cb1-314" tabindex="-1"></a><span class="co">% file_stat = fullfile(data_folder, &#39;stat.csv&#39;);</span></span>
<span id="cb1-315"><a href="the-osprey-job-file.html#cb1-315" tabindex="-1"></a>file_stat <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></span>
<span id="cb1-316"><a href="the-osprey-job-file.html#cb1-316" tabindex="-1"></a></span>
<span id="cb1-317"><a href="the-osprey-job-file.html#cb1-317" tabindex="-1"></a><span class="co">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span>
<span id="cb1-318"><a href="the-osprey-job-file.html#cb1-318" tabindex="-1"></a><span class="co">%%% 5. SPECIFY OUTPUT FOLDER %%</span></span>
<span id="cb1-319"><a href="the-osprey-job-file.html#cb1-319" tabindex="-1"></a><span class="co">% The Osprey data container will be saved as a *.mat file in the output</span></span>
<span id="cb1-320"><a href="the-osprey-job-file.html#cb1-320" tabindex="-1"></a><span class="co">% folder that you specify below. In addition, any exported files (for use</span></span>
<span id="cb1-321"><a href="the-osprey-job-file.html#cb1-321" tabindex="-1"></a><span class="co">% with jMRUI, TARQUIN, or LCModel) will be saved in sub-folders.</span></span>
<span id="cb1-322"><a href="the-osprey-job-file.html#cb1-322" tabindex="-1"></a></span>
<span id="cb1-323"><a href="the-osprey-job-file.html#cb1-323" tabindex="-1"></a><span class="co">% Specify output folder (you can always use the direct path)</span></span>
<span id="cb1-324"><a href="the-osprey-job-file.html#cb1-324" tabindex="-1"></a><span class="co">% (MANDATORY)</span></span>
<span id="cb1-325"><a href="the-osprey-job-file.html#cb1-325" tabindex="-1"></a>outputFolder <span class="op">=</span> <span class="fu">fullfile</span>(data_folder<span class="op">,</span> <span class="st">&#39;derivatives&#39;</span>)<span class="op">;</span></span>
<span id="cb1-326"><a href="the-osprey-job-file.html#cb1-326" tabindex="-1"></a></span>
<span id="cb1-327"><a href="the-osprey-job-file.html#cb1-327" tabindex="-1"></a><span class="co">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></code></pre></div>
</div>
<div id="specifying-sequence-information" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Specifying Sequence Information<a href="the-osprey-job-file.html#specifying-sequence-information" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this section of the job file, some basic acquisition information is specified. These options inform data processing and modeling throughout the <strong>Osprey</strong> pipeline.</p>
<div id="sequence-type" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Sequence Type<a href="the-osprey-job-file.html#sequence-type" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>seqType</code> variable describes the type of sequence used and is a required input in the form of a string.<code>seqType</code> determines whether the supplied datasets have been acquired with spectral editing experiments.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode octave"><code class="sourceCode octave"><span id="cb2-1"><a href="the-osprey-job-file.html#cb2-1" tabindex="-1"></a><span class="co">% Specify sequence type</span></span>
<span id="cb2-2"><a href="the-osprey-job-file.html#cb2-2" tabindex="-1"></a>seqType <span class="op">=</span> <span class="st">&#39;unedited&#39;</span><span class="op">;</span>           <span class="co">% OPTIONS:    - &#39;unedited&#39; (default)</span></span>
<span id="cb2-3"><a href="the-osprey-job-file.html#cb2-3" tabindex="-1"></a>                                <span class="co">%             - &#39;MEGA&#39;</span></span>
<span id="cb2-4"><a href="the-osprey-job-file.html#cb2-4" tabindex="-1"></a>                                <span class="co">%             - &#39;HERMES&#39;</span></span>
<span id="cb2-5"><a href="the-osprey-job-file.html#cb2-5" tabindex="-1"></a>                                <span class="co">%             - &#39;HERCULES&#39;</span></span></code></pre></div>
</div>
<div id="editing-targets" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Editing Targets<a href="the-osprey-job-file.html#editing-targets" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>editTarget</code> variable describes the sequence type and is a required input in the form of a cell array. <code>editTarget</code> determines the target spin system(s) of spectral editing experiments. If no spectral editing has been performed, enter <code>{'none'}</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode octave"><code class="sourceCode octave"><span id="cb3-1"><a href="the-osprey-job-file.html#cb3-1" tabindex="-1"></a><span class="co">% Specify editing targets</span></span>
<span id="cb3-2"><a href="the-osprey-job-file.html#cb3-2" tabindex="-1"></a>editTarget <span class="op">=</span> {<span class="st">&#39;none&#39;</span>}<span class="op">;</span>          <span class="co">% OPTIONS:    - {&#39;none&#39;} (default if &#39;unedited&#39;)</span></span>
<span id="cb3-3"><a href="the-osprey-job-file.html#cb3-3" tabindex="-1"></a>                                <span class="co">%             - {&#39;GABA&#39;}, {&#39;GSH&#39;}, {&#39;Lac&#39;}, {&#39;PE322&#39;}, {&#39;PE398&#39;}  (for &#39;MEGA&#39;)</span></span>
<span id="cb3-4"><a href="the-osprey-job-file.html#cb3-4" tabindex="-1"></a>                                <span class="co">%             - {&#39;GABA&#39;, &#39;GSH&#39;}, {&#39;GABA&#39;, &#39;Lac&#39;}, {&#39;NAA&#39;, &#39;NAAG&#39;} (for &#39;HERMES&#39;and &#39;HERCULES&#39;)</span></span></code></pre></div>
</div>
<div id="data-scenario" class="section level3 hasAnchor" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> Data Scenario<a href="the-osprey-job-file.html#data-scenario" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>datascenario</code> variable specifies the conditions in which the data were acquired.For in-vivo single-voxel MRS, select <code>invivo</code>. Further options are available for data acquired in a phantom, or multi-voxel data acquired with PRIAM or MRSI.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode octave"><code class="sourceCode octave"><span id="cb4-1"><a href="the-osprey-job-file.html#cb4-1" tabindex="-1"></a>                                <span class="co">% Specify data scenario</span></span>
<span id="cb4-2"><a href="the-osprey-job-file.html#cb4-2" tabindex="-1"></a>dataScenario <span class="op">=</span> <span class="st">&#39;invivo&#39;</span><span class="op">;</span>        <span class="co">% OPTIONS:    - &#39;invivo&#39; (default)</span></span>
<span id="cb4-3"><a href="the-osprey-job-file.html#cb4-3" tabindex="-1"></a>                                <span class="co">%             - &#39;phantom&#39;</span></span>
<span id="cb4-4"><a href="the-osprey-job-file.html#cb4-4" tabindex="-1"></a>                                <span class="co">%             - &#39;PRIAM&#39;</span></span>
<span id="cb4-5"><a href="the-osprey-job-file.html#cb4-5" tabindex="-1"></a>                                <span class="co">%             - &#39;MRSI&#39;</span></span></code></pre></div>
</div>
</div>
<div id="data-handling-and-modeling-options" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Data handling and modeling options<a href="the-osprey-job-file.html#data-handling-and-modeling-options" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this section of the job file, you provide information on whether you would like to save the processed data in externally usable file formats (for example, if you want to interface your analysis with LCModel), and specify options for the modeling.</p>
<div id="spectral-registration-options" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Spectral registration options<a href="the-osprey-job-file.html#spectral-registration-options" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>opts.SpecReg</code> option allows the specification of the desired spectral registration method.</p>
<p>By setting <code>opts.SpecReg</code> to <code>RobSpecReg</code>, alignment is performed with lipid/water removal using simialrity meric, and weighted averaging.
By setting <code>opts.SpecReg</code> to <code>ProbSpecReg</code>, Probabilistic spectral alignment is performed, registering to a median target with weighted averaging.
By setting <code>opts.SpecReg</code> to <code>RestrSpecReg</code>, Spectral alignment using similarity metric and weighted average over a restricted fit range.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode octave"><code class="sourceCode octave"><span id="cb5-1"><a href="the-osprey-job-file.html#cb5-1" tabindex="-1"></a>opts.SpecReg <span class="op">=</span> <span class="st">&#39;RobSpecReg&#39;</span><span class="op">;</span>                  <span class="co">% OPTIONS:    - &#39;RobSpecReg&#39; (default) Spectral aligment with Water/Lipid removal, using simialrity meric, and weighted averaging</span></span>
<span id="cb5-2"><a href="the-osprey-job-file.html#cb5-2" tabindex="-1"></a>                                              <span class="co">%             - &#39;ProbSpecReg&#39; Probabilistic spectral aligment to median target and weighted averaging</span></span>
<span id="cb5-3"><a href="the-osprey-job-file.html#cb5-3" tabindex="-1"></a>                                              <span class="co">%             - &#39;RestrSpecReg&#39; Frequency restricted (fit range) spectral aligment, using simialrity meric, and weighted averaging</span></span>
<span id="cb5-4"><a href="the-osprey-job-file.html#cb5-4" tabindex="-1"></a>                                              <span class="co">%             - &#39;none&#39;</span></span></code></pre></div>
</div>
<div id="sub-spectral-alignment" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Sub-spectral alignment<a href="the-osprey-job-file.html#sub-spectral-alignment" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>opts.SubSpecAlignment</code> allows specification of the metric used to optimize sub-spectral alignment. <code>L2Norm</code> is the default, with <code>L1Norm</code> as an alternative option. Choosing <code>none</code> will circumvent sub-spectral alignment altogether.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode octave"><code class="sourceCode octave"><span id="cb6-1"><a href="the-osprey-job-file.html#cb6-1" tabindex="-1"></a>opts.SubSpecAlignment.mets <span class="op">=</span> <span class="st">&#39;L2Norm&#39;</span><span class="op">;</span>          <span class="co">% OPTIONS:    - &#39;L2Norm&#39; (default)</span></span>
<span id="cb6-2"><a href="the-osprey-job-file.html#cb6-2" tabindex="-1"></a>                                                <span class="co">%             - &#39;L1Norm&#39;</span></span>
<span id="cb6-3"><a href="the-osprey-job-file.html#cb6-3" tabindex="-1"></a>                                                <span class="co">%             - &#39;none&#39;</span></span></code></pre></div>
</div>
<div id="eddy-current-correction" class="section level3 hasAnchor" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Eddy-current correction<a href="the-osprey-job-file.html#eddy-current-correction" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>opts.ECC</code> specifies the data to be eddy-current corrected using a corresponding water-unsuppressed reference scan (Klose, Magn Reson Med 14:26-30 (1990)). The sub-structures <code>opts.ECC.raw</code> and <code>opts.ECC.mm</code> correspond to the raw metabolite and macromolecule spectra, respectively. <code>opts.ECC.raw</code> and <code>opts.ECC.mm</code> may be specified as 1 to apply ECC to all data, 0 to not apply ECC at all, or as a vector to apply ECC to a sub-set of the data.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode octave"><code class="sourceCode octave"><span id="cb7-1"><a href="the-osprey-job-file.html#cb7-1" tabindex="-1"></a><span class="co">%Perform eddy-current correction on the metabolite data (raw) or metabolite</span></span>
<span id="cb7-2"><a href="the-osprey-job-file.html#cb7-2" tabindex="-1"></a><span class="co">%-nulled data (mm). This can either be done similar for all data sets by</span></span>
<span id="cb7-3"><a href="the-osprey-job-file.html#cb7-3" tabindex="-1"></a><span class="co">%supplying a single value or specified for each dataset individually by supplying</span></span>
<span id="cb7-4"><a href="the-osprey-job-file.html#cb7-4" tabindex="-1"></a><span class="co">% multiple entries (number has to match the number of datasets) e.g. to perform ECC</span></span>
<span id="cb7-5"><a href="the-osprey-job-file.html#cb7-5" tabindex="-1"></a><span class="co">% for the second dataset only:</span></span>
<span id="cb7-6"><a href="the-osprey-job-file.html#cb7-6" tabindex="-1"></a><span class="co">% opts.ECC.raw               = [0 1];</span></span>
<span id="cb7-7"><a href="the-osprey-job-file.html#cb7-7" tabindex="-1"></a><span class="co">% opts.ECC.mm                = [0 1];</span></span>
<span id="cb7-8"><a href="the-osprey-job-file.html#cb7-8" tabindex="-1"></a></span>
<span id="cb7-9"><a href="the-osprey-job-file.html#cb7-9" tabindex="-1"></a></span>
<span id="cb7-10"><a href="the-osprey-job-file.html#cb7-10" tabindex="-1"></a>opts.ECC.raw                <span class="op">=</span> <span class="fl">1</span><span class="op">;</span>                <span class="co">% OPTIONS:    - &#39;1&#39; (default)</span></span>
<span id="cb7-11"><a href="the-osprey-job-file.html#cb7-11" tabindex="-1"></a>opts.ECC.mm                <span class="op">=</span> <span class="fl">1</span><span class="op">;</span>                 <span class="co">%             - &#39;0&#39; (no)</span></span>
<span id="cb7-12"><a href="the-osprey-job-file.html#cb7-12" tabindex="-1"></a>                                                <span class="co">%             - [] array</span></span></code></pre></div>
</div>
<div id="saving-data-to-external-formats" class="section level3 hasAnchor" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> Saving data to external formats<a href="the-osprey-job-file.html#saving-data-to-external-formats" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>opts.save</code> variable set determines whether <strong>Osprey</strong> saves the processed data in formats that can be interfaced with external analysis software.</p>
<p>By setting <code>opts.saveLCM</code> to <code>1</code>, LCModel-readable <code>.RAW</code> files are produced.<br />
By setting <code>opts.saveJMRUI</code> to <code>1</code>, jMRUI/Tarquin-readable <code>.TXT</code> files are produced.<br />
By setting <code>opts.saveVendor</code> to <code>1</code>, single vendor-specific files are created, i.e.<code>.SDAT/.SPAR</code> files for Philips data, and <code>.RDA</code> files for Siemens data, regardless of the raw data format.<br />
By setting <code>opts.saveNII</code> to <code>1</code>, processed spectra are produced in the NIfTI-MRS format.<br />
By setting <code>opts.savePDF</code> to <code>1</code>, PDF summaries are produced for all subjects after running each module.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode octave"><code class="sourceCode octave"><span id="cb8-1"><a href="the-osprey-job-file.html#cb8-1" tabindex="-1"></a><span class="co">% Save LCModel-exportable files for each spectrum?</span></span>
<span id="cb8-2"><a href="the-osprey-job-file.html#cb8-2" tabindex="-1"></a>opts.saveLCM                <span class="op">=</span> <span class="fl">1</span><span class="op">;</span>                <span class="co">% OPTIONS:    - 0 (no, default)</span></span>
<span id="cb8-3"><a href="the-osprey-job-file.html#cb8-3" tabindex="-1"></a>                                                <span class="co">%             - 1 (yes)</span></span>
<span id="cb8-4"><a href="the-osprey-job-file.html#cb8-4" tabindex="-1"></a></span>
<span id="cb8-5"><a href="the-osprey-job-file.html#cb8-5" tabindex="-1"></a><span class="co">% Save jMRUI-exportable files for each spectrum?</span></span>
<span id="cb8-6"><a href="the-osprey-job-file.html#cb8-6" tabindex="-1"></a>opts.savejMRUI              <span class="op">=</span> <span class="fl">1</span><span class="op">;</span>                <span class="co">% OPTIONS:    - 0 (no, default)</span></span>
<span id="cb8-7"><a href="the-osprey-job-file.html#cb8-7" tabindex="-1"></a>                                                <span class="co">%             - 1 (yes)</span></span>
<span id="cb8-8"><a href="the-osprey-job-file.html#cb8-8" tabindex="-1"></a></span>
<span id="cb8-9"><a href="the-osprey-job-file.html#cb8-9" tabindex="-1"></a><span class="co">% Save processed spectra in vendor-specific format (SDAT/SPAR, RDA, P)?</span></span>
<span id="cb8-10"><a href="the-osprey-job-file.html#cb8-10" tabindex="-1"></a>opts.saveVendor             <span class="op">=</span> <span class="fl">1</span><span class="op">;</span>                <span class="co">% OPTIONS:    - 0 (no, default)</span></span>
<span id="cb8-11"><a href="the-osprey-job-file.html#cb8-11" tabindex="-1"></a>                                                <span class="co">%             - 1 (yes)</span></span>
<span id="cb8-12"><a href="the-osprey-job-file.html#cb8-12" tabindex="-1"></a></span>
<span id="cb8-13"><a href="the-osprey-job-file.html#cb8-13" tabindex="-1"></a><span class="co">% Save processed spectra in NIfTI-MRS format?</span></span>
<span id="cb8-14"><a href="the-osprey-job-file.html#cb8-14" tabindex="-1"></a>opts.saveNII                <span class="op">=</span> <span class="fl">1</span><span class="op">;</span>                <span class="co">% OPTIONS:    - 0 (no, default)</span></span>
<span id="cb8-15"><a href="the-osprey-job-file.html#cb8-15" tabindex="-1"></a>                                                <span class="co">%             - 1 (yes)</span></span>
<span id="cb8-16"><a href="the-osprey-job-file.html#cb8-16" tabindex="-1"></a>                                                </span>
<span id="cb8-17"><a href="the-osprey-job-file.html#cb8-17" tabindex="-1"></a><span class="co">% Save PDF output for all Osprey modules and subjects?</span></span>
<span id="cb8-18"><a href="the-osprey-job-file.html#cb8-18" tabindex="-1"></a>opts.savePDF                <span class="op">=</span> <span class="fl">1</span><span class="op">;</span>                <span class="co">% OPTIONS:    - 0 (no, default)</span></span>
<span id="cb8-19"><a href="the-osprey-job-file.html#cb8-19" tabindex="-1"></a>                                                <span class="co">%             - 1 (yes)</span></span></code></pre></div>
<p>LCModel <code>.RAW</code> files can be loaded via the <code>Other</code> option in the LCModel file type selection menu.</p>
<p>Please be aware that LCModel may prompt you to enter the number of FID data points (a positive integer number, e.g.<code>2048</code>), dwell time (in seconds, e.g.<code>0.0005</code>), and the static magnetic field strength in MHz (e.g.<code>123.26</code> for a Siemens 2.89 T magnet).</p>
<p>In addition to the <code>.RAW</code> files, Osprey also creates the corresponding <code>.CONTROL</code> files. These files can be used for LCModel batch processing.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="the-osprey-job-file.html#cb9-1" tabindex="-1"></a><span class="cf">for</span> file <span class="kw">in</span> /storage/LCModelControlFiles/<span class="pp">*</span><span class="kw">;</span></span>
<span id="cb9-2"><a href="the-osprey-job-file.html#cb9-2" tabindex="-1"></a><span class="cf">do</span> <span class="ex">/usr/local/.lcmodel/bin/lcmodel</span> <span class="op">&lt;</span> <span class="va">$file</span><span class="kw">;</span></span>
<span id="cb9-3"><a href="the-osprey-job-file.html#cb9-3" tabindex="-1"></a><span class="cf">done</span> </span></code></pre></div>

<div class="rmdimportant">
To create working <code>.CONTROL</code> files you have to specify the following mandatory variables in the <code>osp_lcmcontrol_params()</code> function located in the process folder: <code>key</code>, <code>FILBAS</code>, <code>FOLDER</code>, and <code>DOECC</code>.
</div>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="the-osprey-job-file.html#cb10-1" tabindex="-1"></a><span class="ex">key</span> = 0<span class="kw">;</span> <span class="ex">%Your</span> LCM key goes here</span>
<span id="cb10-2"><a href="the-osprey-job-file.html#cb10-2" tabindex="-1"></a><span class="ex">FILBAS</span> = <span class="st">&#39;/storage/myBasisSet_30ms_PRESS.BASIS&#39;</span><span class="kw">;</span> <span class="ex">%</span> Location of .BASIS file used in LCModel</span>
<span id="cb10-3"><a href="the-osprey-job-file.html#cb10-3" tabindex="-1"></a><span class="ex">FOLDER</span> = <span class="st">&#39;/storage/LCMoutput&#39;</span><span class="kw">;</span> <span class="ex">%Output</span> folder <span class="er">(</span><span class="ex">Create</span> this on your linux machine first<span class="kw">)</span></span>
<span id="cb10-4"><a href="the-osprey-job-file.html#cb10-4" tabindex="-1"></a><span class="va">DOECC</span><span class="op">=</span> <span class="st">&#39;F&#39;</span><span class="kw">;</span> <span class="ex">%</span> No eddy current correction in LCModel as this is already performed in Osprey.</span></code></pre></div>

<div class="rmdnote">
The other parameters are optional and are described in the <code>osp_lcmcontrol_params()</code> function.
</div>
<p>When loading <code>.TXT</code> files with Tarquin, you will probably need to enter the echo time in seconds (e.g.<code>0.03</code> for a <code>TE = 30 ms</code> acquisition).</p>
<p>The <code>opts.saveVendor</code> switch has been introduced to sidestep these problems with <code>.RAW</code> and <code>.TXT</code> files. LCModel, TARQUIN and jMRUI accept the <code>.SDAT/.SPAR</code> and <code>.RDA</code> file formats, and should be able to read the header information correctly.</p>
<p>All exported third-party format files are stored in sub-directories of the output folder specified further down in the job file.</p>
</div>
<div id="metabolites-included-in-the-basis-set" class="section level3 hasAnchor" number="4.3.5">
<h3><span class="header-section-number">4.3.5</span> Metabolites included in the basis-set<a href="the-osprey-job-file.html#metabolites-included-in-the-basis-set" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>opts.fit.includeMetabs</code> can be used to specify a custom set of metabolites to be included in the fitting. By default, all of the metabolites listed below are included, but a subset may be specified as a cell array of strings:
<code>opts.fit.includeMetabs = {Cr, CrCH2, GABA, PCr,...}</code></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode octave"><code class="sourceCode octave"><span id="cb11-1"><a href="the-osprey-job-file.html#cb11-1" tabindex="-1"></a><span class="co">% Select the metabolites to be included in the basis set as a cell array,</span></span>
<span id="cb11-2"><a href="the-osprey-job-file.html#cb11-2" tabindex="-1"></a><span class="co">% with entries separates by commas.</span></span>
<span id="cb11-3"><a href="the-osprey-job-file.html#cb11-3" tabindex="-1"></a><span class="co">% With default Osprey basis sets, you can select the following metabolites:</span></span>
<span id="cb11-4"><a href="the-osprey-job-file.html#cb11-4" tabindex="-1"></a><span class="co">% Ala, Asc, Asp, bHB, bHG, Cit, Cr, Cystat, CrCH2, EtOH, GABA, GPC, GSH, Glc, Gln,</span></span>
<span id="cb11-5"><a href="the-osprey-job-file.html#cb11-5" tabindex="-1"></a><span class="co">% Glu, Gly, H2O, mI, Lac, NAA, NAAG, PCh, PCr, PE, Phenyl, sI, Ser,</span></span>
<span id="cb11-6"><a href="the-osprey-job-file.html#cb11-6" tabindex="-1"></a><span class="co">% Tau, Tyros, MM09, MM12, MM14, MM17, MM20, Lip09, Lip13, Lip20.</span></span>
<span id="cb11-7"><a href="the-osprey-job-file.html#cb11-7" tabindex="-1"></a><span class="co">% If you enter &#39;default&#39;, the basis set will include all of the above</span></span>
<span id="cb11-8"><a href="the-osprey-job-file.html#cb11-8" tabindex="-1"></a><span class="co">% except for Ala, bHB, bHG, Cit, Cystat, EtOH, Glc, Gly, Phenyl, Ser, and Tyros.</span></span>
<span id="cb11-9"><a href="the-osprey-job-file.html#cb11-9" tabindex="-1"></a>opts.fit.includeMetabs      <span class="op">=</span> {<span class="st">&#39;default&#39;</span>}<span class="op">;</span>      <span class="co">% OPTIONS:    - {&#39;default&#39;}</span></span>
<span id="cb11-10"><a href="the-osprey-job-file.html#cb11-10" tabindex="-1"></a>                                                <span class="co">%             - {custom}</span></span></code></pre></div>
<p><code>opts.fit.basisSetFile</code> may be manually specified to bypass the Osprey automatic selction, or to specify an alternative. <code>opts.fit.basisSetFile</code> is a string specifying the path to the basis set stored in FID-A format.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode octave"><code class="sourceCode octave"><span id="cb12-1"><a href="the-osprey-job-file.html#cb12-1" tabindex="-1"></a><span class="co">% Optional: In case the automatic basisset picker is not working you can manually</span></span>
<span id="cb12-2"><a href="the-osprey-job-file.html#cb12-2" tabindex="-1"></a><span class="co">% select the path to the basis set in the osprey/fit/basis, i.e.:</span></span>
<span id="cb12-3"><a href="the-osprey-job-file.html#cb12-3" tabindex="-1"></a><span class="co">% opts.fit.basisSetFile = &#39;osprey/fit/basis/3T/philips/mega/press/gaba68/basis_philips_megapress_gaba68.mat&#39;;</span></span>
<span id="cb12-4"><a href="the-osprey-job-file.html#cb12-4" tabindex="-1"></a><span class="co">### Specifying modelling algorithm</span></span></code></pre></div>
<p>The <code>opts.fit.method</code> variable set determines the modeling algorithm used to fit the processed spectra. The default is to use the Osprey method, as described in the <a href="(https://doi.org/10.1016/j.jneumeth.2020.108827)">publication</a>, but Osprey can also utilize LCModel for fitting. If <code>LCModel</code> is specified, Osprey will generate .RAW files of the processed spectra, populate minimal control files, and read the outputs back into the Matlab container.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode octave"><code class="sourceCode octave"><span id="cb13-1"><a href="the-osprey-job-file.html#cb13-1" tabindex="-1"></a><span class="co">% Choose the fitting algorithm</span></span>
<span id="cb13-2"><a href="the-osprey-job-file.html#cb13-2" tabindex="-1"></a>opts.fit.method             <span class="op">=</span> <span class="st">&#39;Osprey&#39;</span><span class="op">;</span>         <span class="co">% OPTIONS:    - &#39;Osprey&#39; (default)</span></span>
<span id="cb13-3"><a href="the-osprey-job-file.html#cb13-3" tabindex="-1"></a>                                                <span class="co">%             - &#39;LCModel&#39;</span></span></code></pre></div>
</div>
<div id="lcmodel-specific-options" class="section level3 hasAnchor" number="4.3.6">
<h3><span class="header-section-number">4.3.6</span> LCModel-specific options<a href="the-osprey-job-file.html#lcmodel-specific-options" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If LCModel is used as a method, further options may be specified. <code>opts.fit.basisSetFile</code>is a string specifying the path to a basis file. <code>opts.fit.controlFile</code> is a string specifying the path to a control file. File-specific entries of the control file will be populated by Osprey, allowing you to simply specify a generic control file template.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode octave"><code class="sourceCode octave"><span id="cb14-1"><a href="the-osprey-job-file.html#cb14-1" tabindex="-1"></a>opts.fit.basisSetFile   <span class="op">=</span> <span class="st">&#39;/storage/LCModelBasisFiles/MyBasis.basis&#39;</span><span class="op">;</span></span>
<span id="cb14-2"><a href="the-osprey-job-file.html#cb14-2" tabindex="-1"></a></span>
<span id="cb14-3"><a href="the-osprey-job-file.html#cb14-3" tabindex="-1"></a><span class="co">% Specify LCModel-type control file (.CONTROL)</span></span>
<span id="cb14-4"><a href="the-osprey-job-file.html#cb14-4" tabindex="-1"></a><span class="co">% This is optional: If you leave this field blank, Osprey will create a</span></span>
<span id="cb14-5"><a href="the-osprey-job-file.html#cb14-5" tabindex="-1"></a><span class="co">% minimum control file for you.</span></span>
<span id="cb14-6"><a href="the-osprey-job-file.html#cb14-6" tabindex="-1"></a>opts.fit.controlFile    <span class="op">=</span> <span class="st">&#39;/storage/LCModelControlFiles/MyControl.control&#39;</span>)<span class="op">;</span></span></code></pre></div>
</div>
<div id="fit-style" class="section level3 hasAnchor" number="4.3.7">
<h3><span class="header-section-number">4.3.7</span> Fit style<a href="the-osprey-job-file.html#fit-style" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>opts.fit.style</code> variable set determines how difference-edited data are modeled.</p>
<p>By setting <code>opts.fit.style</code> to <code>Concatenated</code>, the difference and sum spectra in MEGA, HERMES and HERCULES datasets will be modeled simultaneously, i.e.with common metabolite amplitude parameters across these spectra.
By setting <code>opts.fit.style</code> to <code>Separate</code>, the difference and edit-OFF spectra in MEGA, HERMES and HERCULES datasets will be modeled independently. In this case, the creatine reference signal will be determined from the edit-OFF spectrum.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode octave"><code class="sourceCode octave"><span id="cb15-1"><a href="the-osprey-job-file.html#cb15-1" tabindex="-1"></a><span class="co">% Choose the fitting style for difference-edited datasets (MEGA, HERMES, HERCULES)</span></span>
<span id="cb15-2"><a href="the-osprey-job-file.html#cb15-2" tabindex="-1"></a><span class="co">% (only available for the Osprey fitting method)</span></span>
<span id="cb15-3"><a href="the-osprey-job-file.html#cb15-3" tabindex="-1"></a>opts.fit.style              <span class="op">=</span> <span class="st">&#39;Concatenated&#39;</span><span class="op">;</span>   <span class="co">% OPTIONS:  - &#39;Concatenated&#39; (default) - will fit DIFF and SUM simultaneously)</span></span>
<span id="cb15-4"><a href="the-osprey-job-file.html#cb15-4" tabindex="-1"></a>                                                <span class="co">%           - &#39;Separate&#39; - will fit DIFF and OFF separately</span></span></code></pre></div>
</div>
<div id="fitting-range" class="section level3 hasAnchor" number="4.3.8">
<h3><span class="header-section-number">4.3.8</span> Fitting range<a href="the-osprey-job-file.html#fitting-range" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>opts.fit.range</code> and <code>opts.fit.rangeWater</code> variables determine the fitting range (in ppm) of the metabolite and water spectra, respectively.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode octave"><code class="sourceCode octave"><span id="cb16-1"><a href="the-osprey-job-file.html#cb16-1" tabindex="-1"></a><span class="co">% Determine fitting range (in ppm) for the metabolite and water spectra</span></span>
<span id="cb16-2"><a href="the-osprey-job-file.html#cb16-2" tabindex="-1"></a>opts.fit.range              <span class="op">=</span> [<span class="fl">0.5</span> <span class="fl">4</span>]<span class="op">;</span>          <span class="co">% [ppm] Default: [0.5 4]</span></span>
<span id="cb16-3"><a href="the-osprey-job-file.html#cb16-3" tabindex="-1"></a>opts.fit.rangeWater         <span class="op">=</span> [<span class="fl">2.0</span> <span class="fl">7.4</span>]<span class="op">;</span>        <span class="co">% [ppm] Default: [2.0 7.4]</span></span></code></pre></div>
<p>The <code>opts.fit.GAP</code> option specifies a range (in ppm) to be excluded from the fitting of specified sub-spectra. The input is a vector specifying the upper and lower bounds of the range.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode octave"><code class="sourceCode octave"><span id="cb17-1"><a href="the-osprey-job-file.html#cb17-1" tabindex="-1"></a>opts.fit.GAP.A              <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb17-2"><a href="the-osprey-job-file.html#cb17-2" tabindex="-1"></a>opts.fit.GAP.diff1          <span class="op">=</span> []<span class="op">;</span></span></code></pre></div>
</div>
<div id="baseline-knot-spacing" class="section level3 hasAnchor" number="4.3.9">
<h3><span class="header-section-number">4.3.9</span> Baseline knot spacing<a href="the-osprey-job-file.html#baseline-knot-spacing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>opts.fit.bLineKnotSpace</code> variable determines the spacing (in ppm) between two adjacent knots of the cubic B-spline baseline. This parameter is equivalent to the <code>DKNTMN</code> parameter in LCModel.</p>
<p>Higher values correspond to a stiffer baseline, while lower values will produce a larger number of spline knots, allowing for greater flexibility of the baseline.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode octave"><code class="sourceCode octave"><span id="cb18-1"><a href="the-osprey-job-file.html#cb18-1" tabindex="-1"></a><span class="co">% Determine the baseline knot spacing (in ppm) for the metabolite spectra</span></span>
<span id="cb18-2"><a href="the-osprey-job-file.html#cb18-2" tabindex="-1"></a>opts.fit.bLineKnotSpace     <span class="op">=</span> <span class="fl">0.4</span><span class="op">;</span>              <span class="co">% [ppm] Default: 0.4.</span></span></code></pre></div>
<p>Choosing lower values for the <code>bLineKnotSpace</code> variable will improve the fit quality at the expense of overparametrization of the model. LCModel uses a default knot spacing of <code>DKNTMN = 0.15</code>, i.e.0.15 ppm, which likely allows too much flexibility. In the absence of baseline regularization in the current stage of the <strong>Osprey</strong> model development, we chose to restrict baseline flexibility by opting for a default value of 0.4 ppm.</p>
</div>
<div id="macromolecule-and-lipid-signals" class="section level3 hasAnchor" number="4.3.10">
<h3><span class="header-section-number">4.3.10</span> Macromolecule and lipid signals<a href="the-osprey-job-file.html#macromolecule-and-lipid-signals" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>opts.fit.fitMM</code> variable determines whether simulated Gaussian signals representing broad macromolecular and lipid signals are included in the basis set.</p>
<p>By default, <strong>Osprey</strong> includes these basis functions. If you want to use an experimentally measured MM/lipid basis function, or operate at long echo times where the MM and lipid resonances have decayed, you can set <code>opts.fit.fitMM = 0</code> to exclude them.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode octave"><code class="sourceCode octave"><span id="cb19-1"><a href="the-osprey-job-file.html#cb19-1" tabindex="-1"></a><span class="co">% Add macromolecule and lipid basis functions to the fit?</span></span>
<span id="cb19-2"><a href="the-osprey-job-file.html#cb19-2" tabindex="-1"></a>opts.fit.fitMM              <span class="op">=</span> <span class="fl">1</span><span class="op">;</span>                <span class="co">% OPTIONS:    - 0 (no)</span></span>
<span id="cb19-3"><a href="the-osprey-job-file.html#cb19-3" tabindex="-1"></a>                                                <span class="co">%             - 1 (yes, default)</span></span></code></pre></div>
</div>
<div id="co-edited-macromolecules" class="section level3 hasAnchor" number="4.3.11">
<h3><span class="header-section-number">4.3.11</span> Co-edited macromolecules<a href="the-osprey-job-file.html#co-edited-macromolecules" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>opts.fit.coMM3</code> specifies the approach to modeling the co-edited macromolecule resonance at 3ppm for GABA-edited MRS experiments. By default a 14 Hz Gaussian peak is used as basis function. the options are as follows:
1. <code>3to2MM</code> - uses a fixed 3 to 2 amplitude ratio between the 0.93-ppm-MM peak and the co-edited 3.0-ppm-MM peak by generating a single composite basis function
2. <code>3to2MMsoft</code> - uses a soft constraints during the modeling to enforce 3 to 2 amplitude ratio between the 0.93-ppm-MM peak and the co-edited 3.0-ppm-MM peak
3. <code>1to1GABA</code>. - uses a fixed 1 to 1 amplitude ratio between the GABA and the co-edited 3.0-ppm-MM peak by generating a single composite basis function
4. <code>1to1GABAsoft</code> - uses a soft constraints during the modeling to enforce 1 to 1 amplitude ratio between the GABA and the co-edited 3.0-ppm-MM peak
5. <code>freeGauss</code> - uses a separate basis function for the co-edited 3.0-ppm-MM peak with an initial 14 Hz FWHM of the Gaussian basis function
6. <code>fixedGauss</code> - uses a separate basis function for the co-edited 3.0-ppm-MM peak, however, the FWHM of the Gaussian basis function is optimized during the modeling process
7. <code>none</code> - uses no MM basis function for the co-edited 3.0-ppm MM in the difference spectrum.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode octave"><code class="sourceCode octave"><span id="cb20-1"><a href="the-osprey-job-file.html#cb20-1" tabindex="-1"></a><span class="co">% How do you want to model the co-edited macromolecules at 3 ppm for GABA-edited MRS?</span></span>
<span id="cb20-2"><a href="the-osprey-job-file.html#cb20-2" tabindex="-1"></a>opts.fit.coMM3              <span class="op">=</span> <span class="st">&#39;freeGauss&#39;</span><span class="op">;</span>      <span class="co">% OPTIONS:    - {&#39;3to2MM&#39;} (default)</span></span>
<span id="cb20-3"><a href="the-osprey-job-file.html#cb20-3" tabindex="-1"></a>                                                <span class="co">%             - {&#39;3to2MMsoft&#39;}</span></span>
<span id="cb20-4"><a href="the-osprey-job-file.html#cb20-4" tabindex="-1"></a>                                                <span class="co">%             - {&#39;1to1GABA&#39;}</span></span>
<span id="cb20-5"><a href="the-osprey-job-file.html#cb20-5" tabindex="-1"></a>                                                <span class="co">%             - {&#39;1to1GABAsoft&#39;}</span></span>
<span id="cb20-6"><a href="the-osprey-job-file.html#cb20-6" tabindex="-1"></a>                                                <span class="co">%             - {&#39;freeGauss&#39;}</span></span>
<span id="cb20-7"><a href="the-osprey-job-file.html#cb20-7" tabindex="-1"></a>                                                <span class="co">%             - {&#39;fixedGauss&#39;}</span></span>
<span id="cb20-8"><a href="the-osprey-job-file.html#cb20-8" tabindex="-1"></a>                                                <span class="co">%             - {&#39;none&#39;}</span></span></code></pre></div>
</div>
</div>
<div id="specifying-mrs-data-and-structural-imaging-files" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Specifying MRS data and structural imaging files<a href="the-osprey-job-file.html#specifying-mrs-data-and-structural-imaging-files" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this section of the job file, you specify the full paths to your MRS data and structural imaging files.</p>
<p><strong>Osprey</strong> is designed for the batch analysis of multiple datasets in one session. Each dataset corresponds to an element of a cell array. The cell arrays for metabolite data, water reference data, short-TE water data, and structural imaging files need to have the same number of elements. For example, if you have MRS data from two voxels in the same subject, you need to enter the path to the <code>.NII</code> structural twice into the <code>files_nii</code> cell array.</p>
<p>At the current stage of implementation, you can only analyze one type of sequence per job file, i.e.if you have MEGA-PRESS and PRESS data for each subject, you will have to design two separate job files for MEGA-PRESS and PRESS data.</p>

<div class="rmdimportant">
Files can be specified as explicit paths in the job file, or programmatically using Matlab .m job files. Both approaches are shown in the example job file, with the loop structure designed to pick appropriately named files from a BIDS-compliant data set.
</div>
<div id="metabolite-data" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Metabolite data<a href="the-osprey-job-file.html#metabolite-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>files</code> variable is defined as a cell array of full paths to the raw MRS data files containing your metabolite (water-suppressed) data.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode octave"><code class="sourceCode octave"><span id="cb21-1"><a href="the-osprey-job-file.html#cb21-1" tabindex="-1"></a><span class="co">% Specify metabolite data</span></span>
<span id="cb21-2"><a href="the-osprey-job-file.html#cb21-2" tabindex="-1"></a><span class="co">% (MANDATORY)</span></span>
<span id="cb21-3"><a href="the-osprey-job-file.html#cb21-3" tabindex="-1"></a>files       <span class="op">=</span> {<span class="fu">which</span>(<span class="st">&#39;exampledata/sdat/sub-01/mrs/sub-01_press/sub-01_PRESS_35_act.sdat&#39;</span>)<span class="op">,...</span></span>
<span id="cb21-4"><a href="the-osprey-job-file.html#cb21-4" tabindex="-1"></a>               <span class="fu">which</span>(<span class="st">&#39;exampledata/sdat/sub-02/mrs/sub-02_press/sub-02_PRESS_35_act.sdat&#39;</span>)}<span class="op">;</span></span></code></pre></div>
<p>In the job files in the <code>exampledata</code> folder of the <strong>Osprey</strong> repository, the <code>which</code> function ensures that the paths are correctly defined regardless of where you put your <strong>Osprey</strong> folder. When designing your own job file, you will have to provide the full paths to your raw data, e.g.:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode octave"><code class="sourceCode octave"><span id="cb22-1"><a href="the-osprey-job-file.html#cb22-1" tabindex="-1"></a><span class="co">% Specify metabolite data</span></span>
<span id="cb22-2"><a href="the-osprey-job-file.html#cb22-2" tabindex="-1"></a><span class="co">% (MANDATORY)</span></span>
<span id="cb22-3"><a href="the-osprey-job-file.html#cb22-3" tabindex="-1"></a>files       <span class="op">=</span> {<span class="st">&#39;/Users/Georg/Documents/MRSData/study-01/sub-01/mrs/sub-01_press/sub-01_PRESS_35_act.sdat&#39;</span><span class="op">,...</span></span>
<span id="cb22-4"><a href="the-osprey-job-file.html#cb22-4" tabindex="-1"></a>               <span class="st">&#39;/Users/Georg/Documents/MRSData/study-01/sub-02/mrs/sub-02_press/sub-02_PRESS_35_act.sdat&#39;</span><span class="op">,</span>}<span class="op">;</span></span></code></pre></div>
<p>Instead of writing out the full paths explicitly, you can also create a procedure that is tailored to your local file organization, as long as you end up with a <code>files</code> cell array containing an element for each file you want to analyze.</p>

<div class="rmdwarning">
<p>MRS raw data can be exported in DICOM and Siemens RDA format, where each average is saved as a separate <code>.DCM</code> or <code>.RDA</code> file. In this case, you have to enter the full path to the <strong>folder</strong> containing all single-average files belong to <strong>one acquisition</strong>.</p>
Please refer to the data organization chapter of this documentation for best practices on creating a useful folder structure for your raw data.
</div>
</div>
<div id="lineshape-reference-data" class="section level3 hasAnchor" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Lineshape reference data<a href="the-osprey-job-file.html#lineshape-reference-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>files_ref</code> variable is defined as a cell array of full paths to the raw MRS data files to your lineshape (water-unsuppressed) reference data.</p>
<p>These are an optional input, acquired with the same sequence as the metabolite data, but without water suppression, and used to perform eddy-current correction of the metabolite data.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode octave"><code class="sourceCode octave"><span id="cb23-1"><a href="the-osprey-job-file.html#cb23-1" tabindex="-1"></a><span class="co">% Specify water reference data for eddy-current correction (same sequence as metabolite data!)</span></span>
<span id="cb23-2"><a href="the-osprey-job-file.html#cb23-2" tabindex="-1"></a><span class="co">% (OPTIONAL)</span></span>
<span id="cb23-3"><a href="the-osprey-job-file.html#cb23-3" tabindex="-1"></a><span class="co">% Leave empty for GE P-files (.7) - these include water reference data by</span></span>
<span id="cb23-4"><a href="the-osprey-job-file.html#cb23-4" tabindex="-1"></a><span class="co">% default.</span></span>
<span id="cb23-5"><a href="the-osprey-job-file.html#cb23-5" tabindex="-1"></a>files_ref   <span class="op">=</span> {<span class="fu">which</span>(<span class="st">&#39;exampledata/sdat/sub-01/mrs/sub-01_press-ref/sub-01_PRESS_35_ref.sdat&#39;</span>)<span class="op">,...</span></span>
<span id="cb23-6"><a href="the-osprey-job-file.html#cb23-6" tabindex="-1"></a>               <span class="fu">which</span>(<span class="st">&#39;exampledata/sdat/sub-02/mrs/sub-02_press-ref/sub-02_PRESS_35_ref.sdat&#39;</span>)}<span class="op">;</span></span></code></pre></div>
<p>If only lineshape reference data are provided, this signal is also used to calculate water-scaled concentration estimates.</p>
</div>
<div id="short-te-water-data" class="section level3 hasAnchor" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> Short-TE water data<a href="the-osprey-job-file.html#short-te-water-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>files_w</code> variable is defined as a cell array of full paths to the raw MRS data files to short-TE water data.</p>
<p>These are another optional input, and can be used to derive water-scaled concentration estimates (while lineshape reference data are only used for eddy-current correction). Using short-TE water as the concentration reference standard reduces T2-weighting of the water reference signal (and associated correction errors) compared to long-TE water data.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode octave"><code class="sourceCode octave"><span id="cb24-1"><a href="the-osprey-job-file.html#cb24-1" tabindex="-1"></a><span class="co">% Specify water data for quantification (e.g. short-TE water scan)</span></span>
<span id="cb24-2"><a href="the-osprey-job-file.html#cb24-2" tabindex="-1"></a><span class="co">% (OPTIONAL)</span></span>
<span id="cb24-3"><a href="the-osprey-job-file.html#cb24-3" tabindex="-1"></a>files_w     <span class="op">=</span> {<span class="fu">which</span>(<span class="st">&#39;exampledata/sdat/sub-01/mrs/sub-01_press-ref/sub-01_PRESS_35_ref.sdat&#39;</span>)<span class="op">,...</span></span>
<span id="cb24-4"><a href="the-osprey-job-file.html#cb24-4" tabindex="-1"></a>               <span class="fu">which</span>(<span class="st">&#39;exampledata/sdat/sub-02/mrs/sub-02_press-ref/sub-02_PRESS_35_ref.sdat&#39;</span>)}<span class="op">;</span></span></code></pre></div>
</div>
<div id="structural-images" class="section level3 hasAnchor" number="4.4.4">
<h3><span class="header-section-number">4.4.4</span> Structural images<a href="the-osprey-job-file.html#structural-images" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>files_nii</code> variable is defined as a cell array of full paths to T1-weighted structural images used for co-registration and segmentation purposes.</p>
<p><strong>Osprey</strong> requires NIfTI (<code>.nii</code>) files to be supplied. For GE files, you may also provide the full path to a directory containing the DICOM folders corresponding to the T1 acquisition.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode octave"><code class="sourceCode octave"><span id="cb25-1"><a href="the-osprey-job-file.html#cb25-1" tabindex="-1"></a><span class="co">% Specify T1-weighted structural imaging data</span></span>
<span id="cb25-2"><a href="the-osprey-job-file.html#cb25-2" tabindex="-1"></a><span class="co">% (OPTIONAL)</span></span>
<span id="cb25-3"><a href="the-osprey-job-file.html#cb25-3" tabindex="-1"></a><span class="co">% Link to single NIfTI (.nii) files for Siemens and Philips data</span></span>
<span id="cb25-4"><a href="the-osprey-job-file.html#cb25-4" tabindex="-1"></a><span class="co">% Link to DICOM (.dcm) folders for GE data</span></span>
<span id="cb25-5"><a href="the-osprey-job-file.html#cb25-5" tabindex="-1"></a>files_nii   <span class="op">=</span> {<span class="fu">which</span>(<span class="st">&#39;exampledata/sdat/sub-01/anat/sub-01_T1w.nii&#39;</span>)<span class="op">,...</span></span>
<span id="cb25-6"><a href="the-osprey-job-file.html#cb25-6" tabindex="-1"></a>               <span class="fu">which</span>(<span class="st">&#39;exampledata/sdat/sub-02/anat/sub-02_T1w.nii&#39;</span>)}<span class="op">;</span></span></code></pre></div>
<p><strong>Osprey</strong> uses <strong>SPM12</strong> functions to load and process structural images. Please refer to the <a href="/01-getting-started/02-installing-osprey/">installation instructions</a> for information on how to set up SPM12.</p>

<div class="rmdnote">
It is now also possible to supply Osprey with extrernally segmented images, bypassing SPM12 segmentation.
</div>
<div class="sourceCode" id="cb26"><pre class="sourceCode octave"><code class="sourceCode octave"><span id="cb26-1"><a href="the-osprey-job-file.html#cb26-1" tabindex="-1"></a>        <span class="co">% External segmentation results</span></span>
<span id="cb26-2"><a href="the-osprey-job-file.html#cb26-2" tabindex="-1"></a>        <span class="co">% (OPTIONAL)</span></span>
<span id="cb26-3"><a href="the-osprey-job-file.html#cb26-3" tabindex="-1"></a>        <span class="co">% Link to NIfTI (*.nii or *.nii.gz) files with segmentation results</span></span>
<span id="cb26-4"><a href="the-osprey-job-file.html#cb26-4" tabindex="-1"></a>        <span class="co">% Add supply gray matter, white matter, and CSF as 1 x 3 cell within a</span></span>
<span id="cb26-5"><a href="the-osprey-job-file.html#cb26-5" tabindex="-1"></a>        <span class="co">% cell array  or a single 4D file in the same order supplied as 1 x 1 cell;</span></span>
<span id="cb26-6"><a href="the-osprey-job-file.html#cb26-6" tabindex="-1"></a><span class="co">%         files_seg(counter)   = {{[sess(ll).folder filesep sess(ll).name filesep &#39;anat&#39; filesep subs(kk).name filesep &#39;c1&#39; sess(ll).name &#39;_T1w.nii.gz&#39;],...</span></span>
<span id="cb26-7"><a href="the-osprey-job-file.html#cb26-7" tabindex="-1"></a><span class="co">%                                  [sess(ll).folder filesep sess(ll).name filesep &#39;anat&#39; filesep subs(kk).name filesep &#39;c2&#39; sess(ll).name &#39;_T1w.nii.gz&#39;],...</span></span>
<span id="cb26-8"><a href="the-osprey-job-file.html#cb26-8" tabindex="-1"></a><span class="co">%                                  [sess(ll).folder filesep sess(ll).name filesep &#39;anat&#39; filesep subs(kk).name filesep &#39;c3&#39; sess(ll).name &#39;_T1w.nii.gz&#39;]}};</span></span>
<span id="cb26-9"><a href="the-osprey-job-file.html#cb26-9" tabindex="-1"></a></span>
<span id="cb26-10"><a href="the-osprey-job-file.html#cb26-10" tabindex="-1"></a><span class="co">%         files_seg(counter)   = {{[sess(ll).folder filesep sess(ll).name filesep &#39;anat&#39; filesep subs(kk).name filesep &#39;4D&#39; sess(ll).name &#39;_T1w.nii.gz&#39;]}};</span></span></code></pre></div>
</div>
<div id="specifying-stat-file" class="section level3 hasAnchor" number="4.4.5">
<h3><span class="header-section-number">4.4.5</span> Specifying stat file<a href="the-osprey-job-file.html#specifying-stat-file" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this section of the job it is possible to specify the location of a csv file containing group variables, and possible correlation measures.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode octave"><code class="sourceCode octave"><span id="cb27-1"><a href="the-osprey-job-file.html#cb27-1" tabindex="-1"></a><span class="co">% Supply location of a csv file, which contains possible correlation</span></span>
<span id="cb27-2"><a href="the-osprey-job-file.html#cb27-2" tabindex="-1"></a><span class="co">% measures and group variables. Each column must start with the name of the</span></span>
<span id="cb27-3"><a href="the-osprey-job-file.html#cb27-3" tabindex="-1"></a><span class="co">% measure. For the grouping variable use &#39;group&#39; and numbers between 1 and</span></span>
<span id="cb27-4"><a href="the-osprey-job-file.html#cb27-4" tabindex="-1"></a><span class="co">% the number of included groups. If no group is supplied the data will be</span></span>
<span id="cb27-5"><a href="the-osprey-job-file.html#cb27-5" tabindex="-1"></a><span class="co">% treated as one group. (You can always use the direct path)</span></span>
<span id="cb27-6"><a href="the-osprey-job-file.html#cb27-6" tabindex="-1"></a></span>
<span id="cb27-7"><a href="the-osprey-job-file.html#cb27-7" tabindex="-1"></a><span class="co">% file_stat = fullfile(data_folder, &#39;stat.csv&#39;);</span></span>
<span id="cb27-8"><a href="the-osprey-job-file.html#cb27-8" tabindex="-1"></a>file_stat <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></span></code></pre></div>
</div>
<div id="specifying-the-output-folder" class="section level3 hasAnchor" number="4.4.6">
<h3><span class="header-section-number">4.4.6</span> Specifying the output folder<a href="the-osprey-job-file.html#specifying-the-output-folder" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this section of the job file, you specify the full paths to an output folder where the <strong>Osprey</strong> data container is saved in <code>.mat</code> format. In addition, any exported files (for use with jMRUI, TARQUIN, or LCModel) will be saved in separate sub-folders of the output folder.</p>

<div class="rmdnote">
<p>The <code>outputFolder</code> variable specifies a full path to the output folder.</p>
If the output folder does not exist yet, it will be created.
</div>
<div class="sourceCode" id="cb28"><pre class="sourceCode octave"><code class="sourceCode octave"><span id="cb28-1"><a href="the-osprey-job-file.html#cb28-1" tabindex="-1"></a><span class="co">% Specify output folder</span></span>
<span id="cb28-2"><a href="the-osprey-job-file.html#cb28-2" tabindex="-1"></a><span class="co">% (MANDATORY)</span></span>
<span id="cb28-3"><a href="the-osprey-job-file.html#cb28-3" tabindex="-1"></a>outputFolder <span class="op">=</span> <span class="fu">strrep</span>(<span class="fu">which</span>(<span class="st">&#39;exampledata/sdat/jobSDAT.m&#39;</span>)<span class="op">,</span><span class="st">&#39;jobSDAT.m&#39;</span><span class="op">,</span><span class="st">&#39;derivatives&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>In the job files in the <code>example</code> folder of the <strong>Osprey</strong> repository, the <code>which</code> and <code>strrep</code> functions ensures that an output folder <code>derivatives</code> in the folder where the job file <code>jobSDAT</code> resides. When designing your own job file, you will have to provide the full path to your desired output folder.</p>
<p>Note that <strong>Osprey</strong> detects if the output folder already exists and contains data from a previous analysis. In this case, you will be prompted whether you would like to overwrite the existing output.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="the-osprey-workflow.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="osprey-gui-tutorial.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/schorschinho/osprey/edit/master/03-jobfiles.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
